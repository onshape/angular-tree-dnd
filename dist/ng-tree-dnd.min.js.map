{"version":3,"sources":["ng-tree-dnd.js"],"names":["fnInitTreeDnD","$timeout","$http","$compile","$parse","$window","$document","$templateCache","$TreeDnDTemplate","$TreeDnDClass","$TreeDnDHelper","$TreeDnDPlugin","$TreeDnDViewport","fnController","$scope","$element","$attrs","timeLoadData","treeData","tmpTreeData","reload_data","timeReloadData","check_exist_attr","attrs","existAttr","isAnd","angular","isUndefinedOrNull","isUndefined","isArray","for_each_attrs","exist","i","len","length","passed","generateWatch","type","nameAttr","valDefault","nameScope","fnNotExist","fnAfter","fnBefore","isFunction","$watch","val","indexOf","$safeApply","fn","phase","this","$root","$$phase","$apply","getExpandOn","_len","_firstNode","_keys","Object","keys","_regex","RegExp","test","expandingProperty","getColDefs","_col_defs","push","field","colDefinitions","do_f","root","node","parent","parent_real","level","visible","index","_i","_icon","_index_real","_dept","_hashKey","__children__","__parent_real__","__parent__","__expanded__","expandLevel","__index__","__index_real__","__level__","__icon__","__icon_class__","$class","icon","__visible__","__uid__","Math","random","getHash","__hashKey__","primary_key","__dept__","init_data","data","isDefined","tree_nodes","oData","_data","_tree_nodes","expandOn","columnDefs","orderBy","_fnInitOrderBy","filter","_fnInitFilter","filterOptions","_deptTotal","indent","indent_plus","indent_unit","$tree_class","$type","$globals","copy","extend","1","iconExpand","0","iconCollapse","-1","iconLeaf","for_all_descendants","checkSibling","_nodes","getLastDescendant","last_child","n","tree","anchor_node","getElementChilds","element","querySelector","onClick","event","metaKey","shiftKey","select_anchor_node","on_click","setTimeout","onSelect","ctrlKey","add_select_node","range_select_node","__selected__","on_select","passedExpand","_clone","toggleExpand","fnCallback","$callbacks","expand","_fnGetHash","_fnSetHash","setHash","accept","dragInfo","moveTo","isChanged","dropEnabled","calsIndent","skipUnit","skipEdge","unit","edge","droppable","draggable","dragEnabled","beforeDrop","changeKey","_key","replace","clone","_this","remove","delayReload","temp","splice","clearInfo","__inited__","add","pos","deleteScope","scope","_hash","setScope","getScope","enableDrag","enableDrop","placeElm","horizontal","dragDelay","enabledMove","statusMove","enabledHotkey","enabledCollapse","statusElm","dragging","beforeDrag","scopeDrag","dragStop","info","changed","drag","target","dropped","pass","isMove","_node","nodes","_tree","_nodeAdd","_move","move","_parent","remove_nodes","startPos","forEach","hasSameParent","get_parent","hasLowerIndex","add_nodes","dragStart","dragMove","setDragging","enableMove","enableStatus","enabledStatus","hideStatus","addClass","hidden","refreshStatus","statusElmOld","getMove","getCopy","attr","find","append","removeClass","setPositionStatus","e","css","left","pageX","top","pageY","z-index","status","targeting","getPrevSibling","_index","getNode","initPlace","dragElm","isTable","document","createElement","_len_down","empty","place","height","parentNode","insertBefore","hidePlace","showPlace","getScopeTree","hiddenChild","nodeScope","_fnGetControl","w","_curW","_typeW","_nameW","_defaultW","_scopeW","_NotW","_AfterW","_BeforeW","_defaultFilterOption","showParent","showChild","beginAnd","_watches","isHotkey","templateCopy","_url","get","setCopy","templateMove","setMove","treeClass","trim","$tree","colDefs","filters","_passed","_iF","_keysF","_lenF","enabledFilter","option","primaryKey","indentUnit","optCallbacks","value","key","lenW","equals","updateLimit","$TreeLimit","fnCompile","tElement","$_Template","_element","html","_fnInitDrag","ready","checkTreeTable","template","attrInclude","elemNode","treeInclude","cache","success","tempDiv","innerHTML","setTemplate","templateNode","promiseCheck","then","templateUrl","getPath","restrict","controller","compile","fnInitTreeDnDViewport","$q","update","viewportRect","width","eWindow","prop","documentElement","clientWidth","clientHeight","body","scrollTop","scrollLeft","isUpdating","isRender","updateAgain","recursivePromise","item","number","items","renderTime","cancel","setViewport","viewport","getViewport","updateDelayed","updateTimeout","nodeTemplate","getItems","$initViewport","on","module","constant","handle","directive","link","new_val","compileReplace","replaceWith","fnLink","fnWatchNode","newVal","oldVal","nodeOf","keyNode","first","parentReal","_childs","selected","get_selected_nodes","select_node","hashKey","childsElem","$node_class","enabledDnD","treeDndNode","getData","getScopeNode","objexpr","objprops","keyO","lenO","skipAttr","keepAttr","lenKeep","join","$on","$nodes_class","$inject","factory","$filter","options","fieldChild","parentPassed","_nodePassed","_childPassed","_filter_index","filter_index","_fnCheck","callback","err","_fnProccess","condition","for_each_filter","_iO","_keysO","_lenO","_callback","conditions","_fnAfter","isNodePassed","isChildPassed","isParentPassed","__filtered__","__filtered_visible__","__filtered_index__","_fnBefore","_fnBeforeClear","_fnConvert","_filter","_state","isObject","fnInitFilter","keyChild","_fnOrderBy","name","fnOrderBy","_fnOrder","list","_fnMain","isString","_$initConvert","line2tree","parentKey","parentId","rootIds","_primary","treeObjs","tree2tree","access_child","containKey","_copy","_child","_$helper","nodrag","targetElm","eventObj","obj","undefined","targetTouches","originalEvent","drop","offset","boundingClientRect","getBoundingClientRect","pageYOffset","pageXOffset","positionStarted","offsetX","offsetY","startX","lastX","startY","lastY","nowX","nowY","distX","distY","dirAx","dirX","dirY","lastDirX","lastDirY","distAxX","distAxY","positionMoved","firstMoving","newAx","abs","moving","replaceIndent","children","$injector","_fnget","has","templatePath","copyPath","movePath","scopes","_$init","path","$id","_fnPlaceHolder","$params","_offset","_fnDragStart","hasTouch","button","which","uiTreeDragging","eventElm","eventScope","dragScope","eventElmTagName","toLowerCase","_$scope","preventDefault","tagName","offsetEdge","_width","_scope","_needCollapse","_copied","_tbody","bind","dragEndEvent","dragMoveEvent","dragCancelEvent","document_height","max","scrollHeight","offsetHeight","document_width","scrollWidth","offsetWidth","_fnDragMove","dragStarted","dragDelaying","getSelection","removeAllRanges","selection","leftElmPos","topElmPos","top_scroll","window","bottom_scroll","innerHeight","scrollBy","targetScope","targetBefore","targetInside","targetOffset","isEmpty","isSwapped","_target","fnSwapTree","targetX","targetY","isVeritcal","_info","_drag","_drop","treeScope","isHolder","elementFromPoint","_height","groupId","_prev","dragBorder","after","prepend","lastParent","shouldShowPlace","_fnDragEnd","_isTable","_status","$$apply","_fnBindDrag","unbind","_fnDragStartEvent","dragTimer","_fnKeydownHandler","keyCode","_fnKeyupHandler","bindDrag","dragEnd","keydownHandler","keyupHandler","fnSetCollapse","fnSetExpand","fnSetDeselect","selected_nodes","deselect_all","expand_all_parents","is_selected","deselect_node","deselect_descendants","process_selection","get_next_node","get_prev_node","preserve_anchor","selectedIndex","_children","get_children","child","cleanSelected","selected_child_ct","selected_descendant_ct","sort","a","b","for_all_ancestors","ungroup_node","remove_node","group_selected_nodes","new_parent","nodeId","add_node","new_node","add_to_selection","start_index","add_node_root","expand_all","collapse_all","slice","expand_node","collapse_node","get_anchor_node","get_first_node","get_siblings","get_next_sibling","get_prev_sibling","get_first_child","get_closest_ancestor_next_sibling","get_last_descendant","select_parent_node","select_first_node","select_next_sibling","select_prev_sibling","select_next_node","select_prev_node","run","put"],"mappings":"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","file":"ng-tree-dnd.min.js","sourcesContent":["/**\n * The MIT License (MIT)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to\n * deal in the Software without restriction, including without limitation the\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n * sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n * @preserve\n */\n\n/**\n * Implementing TreeDnD & Event DrapnDrop (allow drag multi tree-table include all type: table, ol, ul)\n * Demo: http://thienhung1989.github.io/angular-tree-dnd\n * Github: https://github.com/thienhung1989/angular-tree-dnd\n * @version 3.0.6\n * @preserve\n * (c) 2015 Nguyun Thin Hng - <nguyenthienhung1989@gmail.com>\n */\n(function () {\n    'use strict';\n    angular.isUndefinedOrNull = isUndefinedOrNull;\n\n    angular.isDefined = isDefined;\n\n    angular.module('ntt.TreeDnD', ['template/TreeDnD/TreeDnD.html'])\n        .constant(\n        '$TreeDnDClass', {\n            tree:   'tree-dnd',\n            empty:  'tree-dnd-empty',\n            hidden: 'tree-dnd-hidden',\n            node:   'tree-dnd-node',\n            nodes:  'tree-dnd-nodes',\n            handle: 'tree-dnd-handle',\n            place:  'tree-dnd-placeholder',\n            drag:   'tree-dnd-drag',\n            status: 'tree-dnd-status',\n            icon:   {\n              '1':  'fa fa-fw fa-chevron-down',\n              '0':  'fa fa-fw fa-chevron-right',\n              '-1': 'fa fa-fw'\n            }\n        }\n    );angular.module('ntt.TreeDnD')\n    .directive(\n    'compile', [\n        '$compile', function ($compile) {\n            return {\n                restrict: 'A',\n                link:     function (scope, element, attrs) {\n                    scope.$watch(\n                        attrs.compile, function (new_val) {\n                            if (new_val) {\n                                if (angular.isFunction(element.empty)) {\n                                    element.empty();\n                                } else {\n                                    element.html('');\n                                }\n\n                                element.append($compile(new_val)(scope));\n                            }\n                        }\n                    );\n                }\n            };\n        }]\n)\n    .directive(\n    'compileReplace', [\n        '$compile', function ($compile) {\n            return {\n                restrict: 'A',\n                link:     function (scope, element, attrs) {\n                    scope.$watch(\n                        attrs.compileReplace, function (new_val) {\n                            if (new_val) {\n                                element.replaceWith($compile(new_val)(scope));\n                            }\n                        }\n                    );\n                }\n            };\n        }]\n);\n\nangular.module('ntt.TreeDnD')\r    .directive(\r    'treeDndNodeHandle', function () {\r        return {\r            restrict: 'A',\r            scope:    true,\r            link:     function (scope, element, attrs) {\r                element.data('$scope', scope);\r                scope.$type = 'TreeDnDNodeHandle';\r                if (scope.$class.handle) {\r                    element.addClass(scope.$class.handle);\r                }\r            }\r        };\r    }\r);\n\nangular.module('ntt.TreeDnD')\r\n    .directive(\r\n    'treeDndNode', ['$TreeDnDViewport', '$timeout', function ($TreeDnDViewport, $timeout) {\r\n        return {\r\n            restrict: 'A',\r\n            replace:  true,\r\n            link:     fnLink\r\n        };\r\n        function fnLink(scope, element, attrs) {\r\n            element.data('$scope', scope);\r\n\r\n            scope.$node_class = '';\r\n\r\n            if (scope.$class.node) {\r\n                element.addClass(scope.$class.node);\r\n                scope.$node_class = scope.$class.node;\r\n            }\r\n            var enabledDnD = typeof scope.dragEnabled === 'boolean' || typeof scope.dropEnabled === 'boolean',\r\n                keyNode    = attrs.treeDndNode,\r\n                first      = true,\r\n                childsElem;\r\n\t\t\t$TreeDnDViewport.add(scope, element);\r\n\r\n            if (enabledDnD) {\r\n                scope.$type = 'TreeDnDNode';\r\n\r\n                scope.getData = function () {\r\n                    return scope[keyNode];\r\n                };\r\n            }\r\n\r\n            scope.$element            = element;\r\n            scope[keyNode].__inited__ = true;\r\n\r\n            scope.getElementChilds = function () {\r\n                return angular.element(element[0].querySelector('[tree-dnd-nodes]'));\r\n            };\r\n\r\n            scope.setScope(scope, scope[keyNode]);\r\n\r\n            scope.getScopeNode = function () {\r\n                return scope;\r\n            };\r\n\r\n            var objprops = [],\r\n                objexpr,\r\n                i, keyO  = Object.keys(scope[keyNode]),\r\n                lenO     = keyO.length,\r\n                hashKey  = scope[keyNode].__hashKey__,\r\n                skipAttr = [\r\n                    '__visible__',\r\n                    '__level__',\r\n                    '__index__',\r\n                    '__index_real__',\r\n\r\n                    '__parent__',\r\n                    '__parent_real__',\r\n                    '__dept__',\r\n                    '__icon__',\r\n                    '__icon_class__'\r\n                ],\r\n                keepAttr = [\r\n                    '__expanded__'\r\n                ],\r\n                lenKeep  = keepAttr.length;\r\n\r\n            // skip __visible__\r\n            for (i = 0; i < lenO + lenKeep; i++) {\r\n                if (i < lenO) {\r\n                    if (skipAttr.indexOf(keyO[i]) === -1) {\r\n                        objprops.push(keyNode + '.' + keyO[i]);\r\n                    }\r\n                } else {\r\n                    if (keyO.indexOf(keepAttr[i - lenO]) === -1) {\r\n                        objprops.push(keyNode + '.' + keepAttr[i - lenO]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            objexpr = '[' + objprops.join(',') + ']';\r\n\r\n            scope.$watch(objexpr, fnWatchNode, true);\r\n\r\n            scope.$on('$destroy', function () {\r\n                scope.deleteScope(scope, scope[keyNode]);\r\n            });\r\n\r\n            function fnWatchNode(newVal, oldVal, scope) {\r\n\r\n\t\t\t\tvar nodeOf = scope[keyNode],\r\n                    _icon;\r\n\r\n                if (first) {\r\n                    _icon                 = nodeOf.__icon__;\r\n                    nodeOf.__icon_class__ = scope.$class.icon[_icon];\r\n                } else {\r\n\r\n                    var parentReal = nodeOf.__parent_real__,\r\n                        parentNode = scope.tree_nodes[parentReal] || null,\r\n                        _childs    = nodeOf.__children__,\r\n                        _len       = _childs.length,\r\n                        _i;\r\n\r\n                    if (!nodeOf.__inited__) {\r\n                        nodeOf.__inited__ = true;\r\n                        if (nodeOf.__selected__) {\r\n                          delete nodeOf.__selected__;\r\n                          // delete the old node if it is already in the selection\r\n                          var selected = scope.tree.get_selected_nodes();\r\n\r\n                          for (var i = 0; i < selected.length; i++) {\r\n                            if (selected[i][scope.primary_key] === nodeOf[scope.primary_key]) {\r\n                              selected.splice(i, 1);\r\n                              break;\r\n                            }\r\n                          }\r\n\r\n                          scope.tree.select_node(nodeOf);\r\n                        }\r\n                    }\r\n\r\n                    if (nodeOf.__hashKey__ !== hashKey) {\r\n                        // clear scope in $globals\r\n                        scope.deleteScope(scope, nodeOf);\r\n\r\n                        // add new scope into $globals\r\n                        scope.setScope(scope, nodeOf);\r\n                        hashKey = nodeOf.__hashKey__;\r\n                    }\r\n\r\n                    if (parentNode && (!parentNode.__expanded__ || !parentNode.__visible__)) {\r\n                        element.addClass(scope.$class.hidden);\r\n                        nodeOf.__visible__ = false;\r\n                    } else {\r\n                        element.removeClass(scope.$class.hidden);\r\n                        nodeOf.__visible__ = true;\r\n                    }\r\n\r\n                    if (_len === 0) {\r\n                        _icon = -1;\r\n                        nodeOf.__expanded__ = false;\r\n                    } else {\r\n                        if (nodeOf.__expanded__) {\r\n                            _icon = 1;\r\n                        } else {\r\n                            _icon = 0;\r\n                        }\r\n                    }\r\n\r\n                    nodeOf.__icon__       = _icon;\r\n                    nodeOf.__icon_class__ = scope.$class.icon[_icon];\r\n\r\n                    if (!scope.isTable) {\r\n                        for (_i = 0; _i < _len; _i++) {\r\n                            scope.for_all_descendants(_childs[_i], scope.hiddenChild, nodeOf, true);\r\n                        }\r\n                    } else {\r\n                        if (!childsElem) {\r\n                            childsElem = scope.getElementChilds();\r\n                        }\r\n\r\n                        if (nodeOf.__expanded__) {\r\n                            childsElem.removeClass(scope.$class.hidden);\r\n                        } else {\r\n                            childsElem.addClass(scope.$class.hidden);\r\n                        }\r\n                    }\r\n\r\n                }\r\n\r\n\t\t\t\tfirst      = false;\r\n\r\n            }\r\n        }\r\n    }]\r\n);\n\nangular.module('ntt.TreeDnD')\n    .directive(\n    'treeDndNodes', function () {\n        return {\n            restrict: 'A',\n            replace:  true,\n            link:     function (scope, element/*, attrs*/) {\n                scope.$type = 'TreeDnDNodes';\n\n                if (scope.$class.nodes) {\n                    element.addClass(scope.$class.nodes);\n                    scope.$nodes_class = scope.$class.nodes;\n                } else {\n                    scope.$nodes_class = '';\n                }\n            }\n        };\n    }\n);\n\nangular.module('ntt.TreeDnD')\n       .directive(\n           'treeDnd', fnInitTreeDnD);\n\nfnInitTreeDnD.$inject = [\n    '$timeout', '$http', '$compile', '$parse', '$window', '$document', '$templateCache',\n    '$TreeDnDTemplate', '$TreeDnDClass', '$TreeDnDHelper', '$TreeDnDPlugin', '$TreeDnDViewport'\n];\n\nfunction fnInitTreeDnD($timeout, $http, $compile, $parse, $window, $document, $templateCache,\n                       $TreeDnDTemplate, $TreeDnDClass, $TreeDnDHelper, $TreeDnDPlugin, $TreeDnDViewport\n) {\n    return {\n        restrict:   'E',\n        scope:      true,\n        replace:    true,\n        controller: ['$scope', '$element', '$attrs', fnController],\n        compile:    fnCompile\n    };\n\n    function fnController($scope, $element, $attrs) {\n        $scope.indent      = 20;\n        $scope.indent_plus = 15;\n        $scope.indent_unit = 'px';\n        $scope.$tree_class = 'table';\n        $scope.primary_key = '__uid__';\n\n        $scope.$type          = 'TreeDnD';\n        // $scope.enabledFilter = null;\n        $scope.colDefinitions = [];\n        $scope.$globals       = {};\n        $scope.$class         = {};\n\n        $scope.treeData   = [];\n        $scope.tree_nodes = [];\n\n        $scope.$class = angular.copy($TreeDnDClass);\n        angular.extend(\n            $scope.$class.icon, {\n                '1':  $attrs.iconExpand     || 'fa fa-fw fa-chevron-down',\n                '0':  $attrs.iconCollapse   || 'fa fa-fw fa-chevron-right',\n                '-1': $attrs.iconLeaf       || 'fa fa-fw'\n            }\n        );\n\n        $scope.for_all_descendants = function (node, fn, parent, checkSibling) {\n            if (angular.isFunction(fn)) {\n                var _i, _len, _nodes;\n\n                if (fn(node, parent)) {\n                    // have error or need ignore children\n                    return false;\n                }\n                _nodes = node.__children__;\n                _len   = _nodes ? _nodes.length : 0;\n                for (_i = 0; _i < _len; _i++) {\n                    if (!$scope.for_all_descendants(_nodes[_i], fn, node) && !checkSibling) {\n                        // skip sibling of node checking\n                        return false;\n                    }\n                }\n            }\n            // succeed then continue\n            return true;\n        };\n\n        $scope.getLastDescendant = function (node) {\n            var last_child, n;\n            if (!node) {\n                node = $scope.tree ? $scope.tree.anchor_node : false;\n            }\n            if (node === false) {\n                return false;\n            }\n            n = node.__children__.length;\n            if (n === 0) {\n                return node;\n            } else {\n                last_child = node.__children__[n - 1];\n                return $scope.getLastDescendant(last_child);\n            }\n        };\n\n        $scope.getElementChilds = function () {\n            return angular.element($element[0].querySelector('[tree-dnd-nodes]'));\n        };\n\n        $scope.onClick = function (node, event) {\n                  if (angular.isDefined($scope.tree)) {\n                    \n                    if (!event.metaKey && !event.shiftKey) {\n                      $scope.tree.select_anchor_node(node);\n                    }\n                    \n                    if (angular.isFunction($scope.tree.on_click)) {\n                      setTimeout(\n                        function () {\n                          $scope.tree.on_click(node);\n                        }, 0\n                      );\n                    }\n                  }\n                };\n\n        $scope.onSelect = function (node, event) {\n          if (angular.isDefined($scope.tree)) {\n            if (event.metaKey || event.ctrlKey) {\n              // add to selection\n              $scope.tree.add_select_node(node);\n            } else if (event.shiftKey) {\n              // select all nodes between anchor and this\n              $scope.tree.range_select_node(node);\n            } else if (!node.__selected__) {\n              $scope.tree.select_anchor_node(node);\n            }\n\n            if (angular.isFunction($scope.tree.on_select)) {\n              setTimeout(\n                  function () {\n                    $scope.tree.on_select(node);\n                  }, 0\n              );\n            }\n          }\n        };\n\n        var passedExpand, _clone;\n        $scope.toggleExpand = function (node, fnCallback) {\n            passedExpand = true;\n            if (angular.isFunction(fnCallback) && !fnCallback(node)) {\n                passedExpand = false;\n            } else if (angular.isFunction($scope.$callbacks.expand) && !$scope.$callbacks.expand(node)) {\n                passedExpand = false;\n            }\n\n            if (passedExpand) {\n                if (node.__children__.length > 0) {\n                    node.__expanded__ = !node.__expanded__;\n                }\n            }\n        };\n\n\n        var _fnGetHash    = function (node) {\n                return '#' + node.__parent__ + '#' + node[$scope.primary_key];\n            },\n            _fnSetHash    = function (node) {\n                var _hashKey = _fnGetHash(node);\n                if (angular.isUndefinedOrNull(node.__hashKey__) || node.__hashKey__ !== _hashKey) {\n                    node.__hashKey__ = _hashKey;\n                }\n                return node;\n            };\n        $scope.getHash    = _fnGetHash;\n        $scope.$callbacks = {\n            getHash:             _fnGetHash,\n            setHash:             _fnSetHash,\n            for_all_descendants: $scope.for_all_descendants,\n            /*expand:              function (node) {\n             return true;\n             },*/\n            accept:              function (dragInfo, moveTo, isChanged) {\n                return $scope.dropEnabled === true;\n            },\n            calsIndent:          function (level, skipUnit, skipEdge) {\n                var unit = 0,\n                    edge = skipEdge ? 0 : $scope.indent_plus;\n                if (!skipUnit) {\n                    unit = $scope.indent_unit ? $scope.indent_unit : 'px';\n                }\n\n                if (level - 1 < 1) {\n                    return edge + unit;\n                } else {\n                    return $scope.indent * (level - 1) + edge + unit;\n                }\n            },\n            droppable:           function () {\n                return $scope.dropEnabled === true;\n            },\n            draggable:           function () {\n                return $scope.dragEnabled === true;\n            },\n            beforeDrop:          function (event) {\n                return true;\n            },\n            changeKey:           function (node) {\n                var _key     = node.__uid__;\n                node.__uid__ = Math.random();\n                if (node.__selected__) {\n                    delete node.__selected__;\n                }\n\n                if ($scope.primary_key !== '__uid__') {\n                    _key = '' + node[$scope.primary_key];\n                    _key = _key.replace(/_#.+$/g, '') + '_#' + node.__uid__;\n\n                    node[$scope.primary_key] = _key;\n                }\n                // delete(node.__hashKey__);\n            },\n            clone:               function (node, _this) {\n                _clone = angular.copy(node);\n                this.for_all_descendants(_clone, this.changeKey);\n                return _clone;\n            },\n            remove:              function (node, parent, _this, delayReload) {\n                var temp = parent.splice(node.__index__, 1)[0];\n                if (!delayReload) {\n                    $scope.reload_data();\n                }\n                return temp;\n            },\n            clearInfo:           function (node) {\n                delete node.__inited__;\n                delete node.__visible__;\n\n                // always changed after call reload_data\n                //delete node.__hashKey__;\n            },\n            add:                 function (node, pos, parent, _this) {\n                // clearInfo\n                this.for_all_descendants(node, this.clearInfo);\n                if (parent) {\n                    if (parent.length > -1) {\n                        if (pos > -1) {\n                            parent.splice(pos, 0, node);\n                        } else {\n                            // todo If children need load crazy\n                            parent.push(node);\n                        }\n                    } else {\n                        parent.push(node);\n                    }\n                }\n            }\n        };\n\n        $scope.deleteScope = function (scope, node) {\n            var _hash = node.__hashKey__;\n            if ($scope.$globals[_hash] && $scope.$globals[_hash] === scope) {\n                delete $scope.$globals[_hash];\n            }\n        };\n\n        $scope.setScope = function (scope, node) {\n            var _hash = node.__hashKey__;\n            if ($scope.$globals[_hash] !== scope) {\n                $scope.$globals[_hash] = scope;\n            }\n        };\n\n        $scope.getScope = function (node) {\n            if (node) {\n                var _hash = node.__hashKey__;\n                //var _hash = typeof node === 'string' ? node : node.__hashKey__;\n                return $scope.$globals[_hash];\n            }\n            return $scope;\n        };\n\n        if ($attrs.enableDrag || $attrs.enableDrop) {\n            $scope.placeElm    = null;\n            //                            $scope.dragBorder = 30;\n            $scope.dragEnabled = null;\n            $scope.dropEnabled = null;\n            $scope.horizontal  = null;\n\n            if ($attrs.enableDrag) {\n\n                $scope.dragDelay       = 0;\n                $scope.enabledMove     = true;\n                $scope.statusMove      = true;\n                $scope.enabledHotkey   = false;\n                $scope.enabledCollapse = null;\n                $scope.statusElm       = null;\n                $scope.dragging        = null;\n\n                angular.extend(\n                    $scope.$callbacks, {\n                        beforeDrag: function (scopeDrag) {\n                            return true;\n                        },\n                        dragStop:   function (info, passed) {\n                            if (!info || !info.changed && info.drag.enabledMove || !passed) {\n                                return null;\n                            }\n\n                            info.target.reload_data();\n\n                            if (info.target !== info.drag && info.drag.enabledMove) {\n                                info.drag.reload_data();\n                            }\n                        },\n                        dropped:    function (info, pass, isMove) {\n                            if (!info) {\n                                return null;\n                            }\n\n                            if (!info.changed && isMove) {\n                              return false;\n                            }\n\n                            var _node = info.node,\n                                _nodes = info.nodes,\n                                _tree = info.drag.tree,\n                                _nodeAdd = null,\n                                _move = info.move,\n                                _parent = _move.parent\n\n                            if (info.target.$callbacks.accept(info, info.move, info.changed)) {\n                              if (isMove) {\n                                _tree.remove_nodes(_nodes, true);\n                              } else {\n                                _nodeAdd = info.drag.$callbacks.clone(_node, info.drag.$callbacks);\n                              }\n                              \n                              // If any of the nodes being moved were removed from the new parent \n                              // with an index before _move.pos, the new position will be incorrect.\n                              // The position will have to be corrected by subtracting the \n                              // number of nodes preceding _move.pos\n                                var startPos = _move.pos;\n                                \n                                if (info.drag === info.target) {\n                                  _nodes.forEach(function(node) {\n                                    var hasSameParent = _tree.get_parent(node) === _move.parent,\n                                        hasLowerIndex = node.__index__ < startPos;\n                                    if (hasSameParent && hasLowerIndex) {\n                                      _move.pos--;\n                                    }\n                                  });\n                                }\n                              \n                              // Add the nodes to the parent at the position.\n                              _tree.add_nodes(_parent, _nodes, _move.pos)\n\n                              return true;\n                            }\n\n                            return false;\n                        },\n                        dragStart:  function (event) {\n                        },\n                        dragMove:   function (event) {\n                        }\n                    }\n                );\n\n                $scope.setDragging = function (dragInfo) {\n                    $scope.dragging = dragInfo;\n                };\n\n                $scope.enableMove = function (val) {\n                    if (typeof val === 'boolean') {\n                        $scope.enabledMove = val;\n                    } else {\n                        $scope.enabledMove = true;\n                    }\n                };\n\n                if ($attrs.enableStatus) {\n                    $scope.enabledStatus = false;\n\n                    $scope.hideStatus = function () {\n                        if ($scope.statusElm) {\n                            $scope.statusElm.addClass($scope.$class.hidden);\n                        }\n                    };\n\n                    $scope.refreshStatus = function () {\n                        if (!$scope.dragging) {\n                            return;\n                        }\n\n                        if ($scope.enabledStatus) {\n                            var statusElmOld = $scope.statusElm;\n                            if ($scope.enabledMove) {\n                                $scope.statusElm = angular.element($TreeDnDTemplate.getMove($scope));\n                            } else {\n                                $scope.statusElm = angular.element($TreeDnDTemplate.getCopy($scope));\n                            }\n\n                            if (statusElmOld !== $scope.statusElm) {\n                                if (statusElmOld) {\n                                    $scope.statusElm.attr('class', statusElmOld.attr('class'));\n                                    $scope.statusElm.attr('style', statusElmOld.attr('style'));\n                                    statusElmOld.remove();\n                                }\n                                $document.find('body').append($scope.statusElm);\n\n                            }\n\n                            $scope.statusElm.removeClass($scope.$class.hidden);\n                        }\n                    };\n\n                    $scope.setPositionStatus = function (e) {\n                        if ($scope.statusElm) {\n                            $scope.statusElm.css(\n                                {\n                                    'left':    e.pageX + 10 + 'px',\n                                    'top':     e.pageY + 15 + 'px',\n                                    'z-index': 9999\n                                }\n                            );\n                            $scope.statusElm.addClass($scope.$class.status);\n                        }\n                    };\n                }\n            }\n\n            $scope.targeting = false;\n\n            $scope.getPrevSibling = function (node) {\n                if (node && node.__index__ > 0) {\n                    var _parent, _index = node.__index__ - 1;\n\n                    if (angular.isDefined(node.__parent_real__)) {\n                        _parent = $scope.tree_nodes[node.__parent_real__];\n                        return _parent.__children__[_index];\n                    }\n                    return $scope.treeData[_index];\n\n                }\n                return null;\n            };\n\n            $scope.getNode = function (index) {\n                if (angular.isUndefinedOrNull(index)) {\n                    return null;\n                }\n                return $scope.tree_nodes[index];\n            };\n\n            $scope.initPlace = function (element, dragElm) {\n\n                if (!$scope.placeElm) {\n                    if ($scope.isTable) {\n                        $scope.placeElm = angular.element($window.document.createElement('tr'));\n                        var _len_down   = $scope.colDefinitions.length;\n                        $scope.placeElm.append(\n                            angular.element($window.document.createElement('td'))\n                                   .addClass($scope.$class.empty)\n                                   .addClass('indented')\n                                   .addClass($scope.$class.place)\n                        );\n                        while (_len_down-- > 0) {\n                            $scope.placeElm.append(\n                                angular.element($window.document.createElement('td'))\n                                       .addClass($scope.$class.empty)\n                                       .addClass($scope.$class.place)\n                            );\n                        }\n                    } else {\n                        $scope.placeElm = angular.element($window.document.createElement('li'))\n                                                 .addClass($scope.$class.empty)\n                                                 .addClass($scope.$class.place);\n                    }\n\n                }\n\n                if (dragElm) {\n                    $scope.placeElm.css('height', $TreeDnDHelper.height(dragElm) + 'px');\n                }\n\n                if (element) {\n                    element[0].parentNode.insertBefore($scope.placeElm[0], element[0]);\n                } else {\n                    $scope.getElementChilds().append($scope.placeElm);\n                }\n\n                return $scope.placeElm;\n            };\n\n            $scope.hidePlace = function () {\n                if ($scope.placeElm) {\n                    $scope.placeElm.addClass($scope.$class.hidden);\n                }\n            };\n\n            $scope.showPlace = function () {\n                if ($scope.placeElm) {\n                    $scope.placeElm.removeClass($scope.$class.hidden);\n                }\n            };\n\n            $scope.getScopeTree = function () {\n                return $scope;\n            };\n\n        }\n\n        $scope.$safeApply = $safeApply;\n\n\n        $scope.hiddenChild       = function fnHiddenChild(node, parent) {\n            var nodeScope = $scope.getScope(node);\n            if (nodeScope) {\n                if (parent && parent.__expanded__ && parent.__visible__) {\n                    nodeScope.$element.removeClass($scope.$class.hidden);\n                    node.__visible__ = true;\n                } else {\n                    nodeScope.$element.addClass($scope.$class.hidden);\n                    node.__visible__ = false;\n                }\n            } else {\n                // show node & init scope\n                if (parent && parent.__expanded__ && parent.__visible__) {\n                    node.__visible__ = true;\n                } else {\n                    node.__visible__ = false;\n                }\n            }\n\n            // skip all child hiding... if not expaned\n            return node.__expanded__ === false;\n        }\n        var _fnInitFilter,\n            _fnInitOrderBy,\n            _fnGetControl,\n            _defaultFilterOption = {\n                showParent: true,\n                showChild:  false,\n                beginAnd:   true\n            },\n            tree,\n            _watches             = [\n                [\n                    'enableDrag', [\n                    ['boolean', 'enableStatus', null, 'enabledStatus'],\n                    ['boolean', 'enableMove', null, 'enabledMove'],\n                    ['number', 'dragDelay', 0, null, 0],\n                    ['boolean', 'enableCollapse', null, 'enabledCollapse'],\n                    [\n                        'boolean', 'enableHotkey', null, 'enabledHotkey', null, function (isHotkey) {\n                        if (isHotkey) {\n                            $scope.enabledMove = false;\n                        } else {\n                            $scope.enabledMove = $scope.statusMove;\n                        }\n                    }]\n                ]],\n                [\n                    ['enableDrag', 'enableStatus'], [\n                    [\n                        'string', 'templateCopy', $attrs.templateCopy, 'templateCopy', null,\n                        function (_url) {\n                            if (_url && $templateCache.get(_url)) {\n                                $TreeDnDTemplate.setCopy(_url, $scope);\n                            }\n                        }],\n                    [\n                        'string', 'templateMove', $attrs.templateMove, 'templateMove', null,\n                        function (_url) {\n                            if (_url && $templateCache.get(_url)) {\n                                $TreeDnDTemplate.setMove(_url, $scope);\n                            }\n                        }]\n                ]],\n                [\n                    [['enableDrag', 'enableDrop']], [\n                    ['number', 'dragBorder', 30, 'dragBorder', 30]]\n                ],\n                [\n                    '*', [\n                    ['boolean', 'treeTable', true, 'treeTable', null],\n                    ['boolean', 'horizontal'],\n                    [\n                        'callback', 'treeClass', function (val) {\n                        switch (typeof val) {\n                            case 'string':\n                                $scope.$tree_class = val;\n                                break;\n                            case 'object':\n                                angular.extend($scope.$class, val);\n                                $scope.$tree_class = $scope.$class.tree;\n                                break;\n                            default:\n                                $scope.$tree_class = $attrs.treeClass;\n                                break;\n                        }\n                    }, 'treeClass', function () {\n                        $scope.$tree_class = $scope.$class.tree + ' table';\n                    }, null, function () {\n                        if (/^(\\s+[\\w\\-]+){2,}$/g.test(' ' + $attrs.treeClass)) {\n                            $scope.$tree_class = $attrs.treeClass.trim();\n                            return true;\n                        }\n                    }],\n                    [\n                        ['object', 'string'], 'expandOn', getExpandOn, 'expandingProperty', getExpandOn,\n                        function (expandOn) {\n                            if (angular.isUndefinedOrNull(expandOn)) {\n                                $scope.expandingProperty = $attrs.expandOn;\n                            }\n                        }],\n                    [\n                        'object', 'treeControl', angular.isDefined($scope.tree) ? $scope.tree : {},\n                        'tree', null, function ($tree) {\n\n                        if (!angular.isFunction(_fnGetControl)) {\n                            _fnGetControl = $TreeDnDPlugin('$TreeDnDControl');\n                        }\n\n                        if (angular.isFunction(_fnGetControl)) {\n                            tree = angular.extend(\n                                $tree,\n                                _fnGetControl($scope)\n                            );\n                        }\n                    }],\n                    [\n                        ['array', 'object'], 'columnDefs', getColDefs, 'colDefinitions', getColDefs,\n                        function (colDefs) {\n                            if (angular.isUndefinedOrNull(colDefs) || !angular.isArray(colDefs)) {\n                                $scope.colDefinitions = getColDefs();\n                            }\n                        }],\n                    [['object', 'string', 'array', 'function'], 'orderBy', $attrs.orderBy],\n                    [\n                        ['object', 'array'], 'filter', null, 'filter', null, function (filters) {\n                        var _passed = false;\n                        if (angular.isDefined(filters) && !angular.isArray(filters)) {\n                            var _keysF = Object.keys(filters),\n                                _lenF  = _keysF.length, _iF;\n\n                            if (_lenF > 0) {\n                                for (_iF = 0; _iF < _lenF; _iF++) {\n\n                                    if (typeof filters[_keysF[_iF]] === 'string' &&\n                                        filters[_keysF[_iF]].length === 0) {\n                                        continue;\n                                    }\n                                    _passed = true;\n                                    break;\n                                }\n                            }\n                        }\n\n                        $scope.enabledFilter = _passed;\n                        reload_data();\n                    }],\n                    [\n                        'object', 'filterOptions', _defaultFilterOption, 'filterOptions',\n                        _defaultFilterOption, function (option) {\n                        if (typeof option === 'object') {\n                            $scope.filterOptions = angular.extend(_defaultFilterOption, option);\n                        }\n                    }],\n                    ['string', 'primaryKey', $attrs.primaryKey, 'primary_key', '__uid__'],\n                    ['string', 'indentUnit', $attrs.indentUnit, 'indent_unit'],\n                    ['number', 'indent', 30, null, 30],\n                    ['number', 'indentPlus', 20, null, 20],\n                    [\n                        'null', 'callbacks',\n                        function (optCallbacks) {\n                            angular.forEach(\n                                optCallbacks, function (value, key) {\n                                    if (typeof value === 'function') {\n                                        if ($scope.$callbacks[key]) {\n                                            $scope.$callbacks[key] = value;\n                                        }\n                                    }\n                                }\n                            );\n                            return $scope.$callbacks;\n                        },\n                        '$callbacks'\n                    ],\n                    [\n                        'number', 'expandLevel', 3, 'expandLevel', 3, function () {\n                        reload_data();\n                    }],\n                    ['number', 'treeLimit', 100, '$TreeLimit', 100],\n                    ['boolean', 'enableDrag', null, 'dragEnabled'],\n                    ['boolean', 'enableDrop', null, 'dropEnabled']\n                ]]\n            ],\n            w, lenW              = _watches.length,\n            i, len,\n            _curW,\n            _typeW, _nameW, _defaultW, _scopeW, _NotW, _AfterW, _BeforeW,\n\n            // debounce reload_Data;\n            timeReloadData, tmpTreeData;\n\n        for (w = 0; w < lenW; w++) {\n            // skip if not exist\n            if (!check_exist_attr($attrs, _watches[w][0], true)) {\n                continue;\n            }\n            _curW = _watches[w][1];\n            for (i = 0, len = _curW.length; i < len; i++) {\n                _typeW    = _curW[i][0];\n                _nameW    = _curW[i][1];\n                _defaultW = _curW[i][2];\n                _scopeW   = _curW[i][3];\n                _NotW     = _curW[i][4];\n                _AfterW   = _curW[i][5];\n                _BeforeW  = _curW[i][6];\n                generateWatch(_typeW, _nameW, _defaultW, _scopeW, _NotW, _AfterW, _BeforeW);\n            }\n        }\n\n        if ($attrs.treeData) {\n            $scope.$watch(\n                $attrs.treeData, function (val) {\n                    if (angular.equals(val, $scope.treeData)) {\n                        return;\n                    }\n\n                    tmpTreeData = val;\n                    if (angular.isUndefinedOrNull(timeReloadData)) {\n                        timeReloadData = $timeout(timeLoadData, 350);\n                    }\n                }, true\n            );\n        }\n\n        function timeLoadData() {\n            $scope.treeData = tmpTreeData;\n            reload_data();\n            timeReloadData = null;\n        }\n\n        $scope.updateLimit = function updateLimit() {\n            //console.log('Call fn UpdateLimit');\n            $scope.$TreeLimit += 50;\n        };\n\n        $scope.reload_data = reload_data;\n\n        function check_exist_attr(attrs, existAttr, isAnd) {\n            if (angular.isUndefinedOrNull(existAttr)) {\n                return false;\n            }\n\n            if (existAttr === '*' || !angular.isUndefined(attrs[existAttr])) {\n                return true;\n            }\n\n            if (angular.isArray(existAttr)) {\n                return for_each_attrs(attrs, existAttr, isAnd);\n            }\n        }\n\n        function for_each_attrs(attrs, exist, isAnd) {\n            var i, len = exist.length, passed = false;\n\n            if (len === 0) {\n                return null;\n            }\n            for (i = 0; i < len; i++) {\n                if (check_exist_attr(attrs, exist[i], !isAnd)) {\n                    passed = true;\n                    if (!isAnd) {\n                        return true;\n                    }\n                } else {\n                    if (isAnd) {\n                        return false;\n                    }\n                }\n            }\n\n            return passed;\n        }\n\n        function generateWatch(type, nameAttr, valDefault, nameScope, fnNotExist, fnAfter,\n                               fnBefore\n        ) {\n            nameScope = nameScope || nameAttr;\n            if (typeof type === 'string' || angular.isArray(type)) {\n                if (angular.isFunction(fnBefore) && fnBefore()) {\n                    return;//jmp\n                }\n                if (typeof $attrs[nameAttr] === 'string') {\n                    $scope.$watch(\n                        $attrs[nameAttr], function (val) {\n                            if (typeof type === 'string' && typeof val === type ||\n                                angular.isArray(type) && type.indexOf(typeof val) > -1\n                            ) {\n                                $scope[nameScope] = val;\n                            } else {\n                                if (angular.isFunction(valDefault)) {\n                                    $scope[nameScope] = valDefault(val);\n                                } else {\n                                    $scope[nameScope] = valDefault;\n                                }\n                            }\n\n                            if (angular.isFunction(fnAfter)) {\n                                fnAfter($scope[nameScope], $scope);\n                            }\n                        }, true\n                    );\n                } else {\n\n                    if (angular.isFunction(fnNotExist)) {\n                        $scope[nameScope] = fnNotExist();\n                    } else if (!angular.isUndefined(fnNotExist)) {\n                        $scope[nameScope] = fnNotExist;\n                    }\n                }\n            }\n        }\n\n        function $safeApply(fn) {\n            var phase = this.$root.$$phase;\n            if (phase === '$apply' || phase === '$digest') {\n                if (fn && typeof fn === 'function') {\n                    fn();\n                }\n            } else {\n                this.$apply(fn);\n            }\n        }\n\n        function getExpandOn() {\n            if ($scope.treeData && $scope.treeData.length) {\n                var _firstNode = $scope.treeData[0], _keys = Object.keys(_firstNode),\n                    _regex                                 = new RegExp('^__([a-zA-Z0-9_\\-]*)__$'),\n                    _len,\n                    i;\n                // Auto get first field with type is string;\n                for (i = 0, _len = _keys.length; i < _len; i++) {\n                    if (typeof _firstNode[_keys[i]] === 'string' && !_regex.test(_keys[i])) {\n                        $scope.expandingProperty = _keys[i];\n                        return;\n                    }\n                }\n\n                // Auto get first\n                if (angular.isUndefinedOrNull($scope.expandingProperty)) {\n                    $scope.expandingProperty = _keys[0];\n                }\n\n            }\n        }\n\n        function getColDefs() {\n            // Auto get Defs except attribute __level__ ....\n            if ($scope.treeData.length) {\n                var _col_defs = [], _firstNode = $scope.treeData[0],\n                    _regex                     = new RegExp('(^__([a-zA-Z0-9_\\-]*)__$|^' + $scope.expandingProperty + '$)'),\n                    _keys                      = Object.keys(_firstNode),\n                    i, _len;\n                // Auto get first field with type is string;\n                for (i = 0, _len = _keys.length; i < _len; i++) {\n                    if (typeof _firstNode[_keys[i]] === 'string' && !_regex.test(_keys[i])) {\n                        _col_defs.push(\n                            {\n                                field: _keys[i]\n                            }\n                        );\n                    }\n                }\n                $scope.colDefinitions = _col_defs;\n            }\n        }\n\n        function do_f(root, node, parent, parent_real, level, visible, index) {\n            var _i, _len, _icon, _index_real, _dept, _hashKey;\n            if (!angular.isArray(node.__children__)) {\n                node.__children__ = [];\n            }\n\n            node.__parent_real__ = parent_real;\n            node.__parent__      = parent;\n            _len                 = node.__children__.length;\n\n            if (angular.isUndefinedOrNull(node.__expanded__) && _len > 0) {\n                node.__expanded__ = level < $scope.expandLevel;\n            }\n\n            if (_len === 0) {\n                _icon = -1;\n            } else {\n                if (node.__expanded__) {\n                    _icon = 1;\n                } else {\n                    _icon = 0;\n                }\n            }\n\n            // Insert item vertically\n            _index_real         = root.length;\n            node.__index__      = index;\n            node.__index_real__ = _index_real;\n            node.__level__      = level;\n            node.__icon__       = _icon;\n            node.__icon_class__ = $scope.$class.icon[_icon];\n            node.__visible__    = !!visible;\n\n            if (angular.isUndefinedOrNull(node.__uid__)) {\n                node.__uid__ = '' + Math.random();\n            }\n\n            _hashKey = $scope.getHash(node);\n\n            if (angular.isUndefinedOrNull(node.__hashKey__) || node.__hashKey__ !== _hashKey) {\n                node.__hashKey__ = _hashKey;\n            }\n\n            root.push(node);\n\n            // Check node children\n            _dept = 1;\n            if (_len > 0) {\n                for (_i = 0; _i < _len; _i++) {\n                    _dept += do_f(\n                        root,\n                        node.__children__[_i],\n                        node[$scope.primary_key],\n                        _index_real,\n                        level + 1,\n                        visible && node.__expanded__,\n                        _i\n                    );\n                }\n            }\n\n            node.__dept__ = _dept;\n\n            return _dept;\n        }\n\n        function init_data(data) {\n\n            // clear memory\n            if (angular.isDefined($scope.tree_nodes)) {\n                delete $scope.tree_nodes;\n            }\n\n            $scope.tree_nodes = data;\n            return data;\n        }\n\n        function reload_data(oData) {\n            var _data,\n                _len,\n                _tree_nodes = [];\n            if (angular.isDefined(oData)) {\n                if (!angular.isArray(oData) || oData.length === 0) {\n                    return init_data([]);\n                } else {\n                    _data = oData;\n                }\n            } else if (!angular.isArray($scope.treeData) || $scope.treeData.length === 0) {\n                return init_data([]);\n            } else {\n                _data = $scope.treeData;\n            }\n\n            if (!$attrs.expandOn) {\n                getExpandOn();\n            }\n\n            if (!$attrs.columnDefs) {\n                getColDefs();\n            }\n\n            if (angular.isDefined($scope.orderBy)) {\n                if (!angular.isFunction(_fnInitOrderBy)) {\n                    _fnInitOrderBy = $TreeDnDPlugin('$TreeDnDOrderBy');\n                }\n\n                if (angular.isFunction(_fnInitOrderBy)) {\n                    _data = _fnInitOrderBy(_data, $scope.orderBy);\n                }\n            }\n\n            if (angular.isDefined($scope.filter)) {\n                if (!angular.isFunction(_fnInitFilter)) {\n                    _fnInitFilter = $TreeDnDPlugin('$TreeDnDFilter');\n                }\n\n                if (angular.isFunction(_fnInitFilter)) {\n                    _data = _fnInitFilter(_data, $scope.filter, $scope.filterOptions);\n                }\n            }\n\n            _len = _data.length;\n            if (_len > 0) {\n                var _i,\n                    _deptTotal = 0;\n\n                for (_i = 0; _i < _len; _i++) {\n                    _deptTotal += do_f(_tree_nodes, _data[_i], null, null, 1, true, _i);\n                }\n\n            }\n\n            init_data(_tree_nodes);\n\n            return _tree_nodes;\n        }\n    }\n\n    function fnCompile(tElement) {\n\n        var $_Template = '',\n            _element   = tElement.html().trim();\n\n        if (_element.length > 0) {\n            $_Template = _element;\n            tElement.html('');\n        }\n\n        return function fnPost(scope, element, attrs) {\n\n            if (attrs.enableDrag) {\n                var _fnInitDrag = $TreeDnDPlugin('$TreeDnDDrag');\n                if (angular.isFunction(_fnInitDrag)) {\n                    _fnInitDrag(scope, element, $window, $document);\n                }\n            }\n\n            // kick out $digest\n            element.ready(function () {\n                // apply Template\n                function checkTreeTable(template, scope) {\n                    var elemNode = template[0].querySelector('[tree-dnd-node]'),\n                        attrInclude;\n\n                    scope.isTable = null;\n                    if (elemNode) {\n                        elemNode    = angular.element(elemNode);\n                        attrInclude = elemNode.attr('ng-include');\n                    } else {\n                        return;\n                    }\n\n                    if (attrInclude) {\n                        var treeInclude = $parse(attrInclude)(scope) || attrInclude;\n                        if (typeof treeInclude === 'string') {\n                            return $http.get(\n                                treeInclude,\n                                {cache: $templateCache}\n                            ).success(\n                                function (data) {\n                                    data              = data.trim();\n                                    //scope.templateNode = data;\n                                    var tempDiv       = document.createElement('div');\n                                    tempDiv.innerHTML = data;\n                                    tempDiv           = angular.element(tempDiv);\n                                    scope.isTable     = !tempDiv[0].querySelector('[tree-dnd-nodes]');\n                                }\n                            );\n                        }\n                    } else {\n                        scope.isTable = !elemNode[0].querySelector('[tree-dnd-nodes]');\n                        //scope.templateNode = elemNode.html();\n                    }\n                    $TreeDnDViewport.setTemplate(scope, scope.templateNode);\n                    //elemNode.html('');\n                }\n\n                //scope.$watch(tableDataLoaded, transformTable);\n                /*\n                 function tableDataLoaded(elem) {\n                 // first cell in the tbody exists when data is loaded but doesn't have a width\n                 // until after the table is transformed\n                 var firstCell = elem.querySelector('tbody tr:first-child td:first-child');\n                 return firstCell && !firstCell.style.width;\n                 }\n\n                 function transformTable(elem, attrs) {\n                 // reset display styles so column widths are correct when measured below\n                 angular.element(elem.querySelectorAll('thead, tbody, tfoot')).css('display', '');\n\n                 // wrap in $timeout to give table a chance to finish rendering\n                 $timeout(function () {\n                 // set widths of columns\n                 angular.forEach(elem.querySelectorAll('tr:first-child th'), function (thElem, i) {\n\n                 var tdElems = elem.querySelector('tbody tr:first-child td:nth-child(' + (i + 1) + ')');\n                 var tfElems = elem.querySelector('tfoot tr:first-child td:nth-child(' + (i + 1) + ')');\n\n                 var columnWidth = tdElems ? tdElems.offsetWidth : thElem.offsetWidth;\n                 if (tdElems) {\n                 tdElems.style.width = columnWidth + 'px';\n                 }\n                 if (thElem) {\n                 thElem.style.width = columnWidth + 'px';\n                 }\n                 if (tfElems) {\n                 tfElems.style.width = columnWidth + 'px';\n                 }\n                 });\n\n                 // set css styles on thead and tbody\n                 angular.element(elem.querySelectorAll('thead, tfoot')).css('display', 'block');\n\n                 angular.element(elem.querySelectorAll('tbody')).css({\n                 'display':  'block',\n                 'height':   attrs.tableHeight || 'inherit',\n                 'overflow': 'auto'\n                 });\n\n                 // reduce width of last column by width of scrollbar\n                 var tbody          = elem.querySelector('tbody');\n                 var scrollBarWidth = tbody.offsetWidth - tbody.clientWidth;\n                 if (scrollBarWidth > 0) {\n                 // for some reason trimming the width by 2px lines everything up better\n                 scrollBarWidth -= 2;\n                 var lastColumn         = elem.querySelector('tbody tr:first-child td:last-child');\n                 lastColumn.style.width = lastColumn.offsetWidth - scrollBarWidth + 'px';\n                 }\n                 });\n                 }*/\n                var promiseCheck;\n                if ($_Template.length > 0) {\n                    promiseCheck = checkTreeTable(angular.element($_Template.trim()), scope);\n                    if (typeof promiseCheck === 'object') {\n                        promiseCheck.then(function () {\n                            element.append($compile($_Template)(scope));\n                        });\n                    } else {\n                        element.append($compile($_Template)(scope));\n                    }\n                } else {\n                    $http.get(\n                        attrs.templateUrl || $TreeDnDTemplate.getPath(),\n                        {cache: $templateCache}\n                    ).success(\n                        function (data) {\n                            data         = angular.element(data.trim());\n                            promiseCheck = checkTreeTable(data, scope);\n                            if (typeof promiseCheck === 'object') {\n                                promiseCheck.then(function () {\n                                    element.append($compile(data)(scope));\n                                });\n                            } else {\n                                element.append($compile(data)(scope));\n                            }\n                        }\n                    );\n                }\n            })\n        };\n    }\n}\n\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDFilter', [\n        '$filter', function ($filter) {\n            return fnInitFilter;\n\n            function for_all_descendants(options, node, fieldChild, fnBefore, fnAfter, parentPassed) {\n                if (!angular.isFunction(fnBefore)) {\n                    return null;\n                }\n\n                var _i, _len, _nodes,\n                    _nodePassed  = fnBefore(options, node),\n                    _childPassed = false,\n                    _filter_index = options.filter_index;\n\n                if (angular.isDefined(node[fieldChild])) {\n                    _nodes = node[fieldChild];\n                    _len   = _nodes.length;\n                    options.filter_index = 0;\n                    for (_i = 0; _i < _len; _i++) {\n                        _childPassed = for_all_descendants(\n                                options,\n                                _nodes[_i],\n                                fieldChild,\n                                fnBefore,\n                                fnAfter,\n                                       _nodePassed || parentPassed\n                            ) || _childPassed;\n                    }\n\n                    // restore filter_index of node\n                    options.filter_index = _filter_index;\n                }\n\n                if (angular.isFunction(fnAfter)) {\n                    fnAfter(options, node, _nodePassed === true, _childPassed === true, parentPassed === true);\n                }\n\n                return _nodePassed || _childPassed;\n            }\n\n            /**\n             * Check data with callback\n             * @param {string|object|function|regex} callback\n             * @param {*} data\n             * @returns {null|boolean}\n             * @private\n             */\n            function _fnCheck(callback, data) {\n                if (angular.isUndefinedOrNull(data) || angular.isArray(data)) {\n                    return null;\n                }\n\n                if (angular.isFunction(callback)) {\n                    return callback(data, $filter);\n                } else {\n                    if (typeof callback === 'boolean') {\n                        data = !!data;\n                        return data === callback;\n                    } else if (angular.isDefined(callback)) {\n                        try {\n                            var _regex = new RegExp(callback);\n                            return _regex.test(data);\n                        }\n                        catch (err) {\n                            if (typeof data === 'string') {\n                                return data.indexOf(callback) > -1;\n                            } else {\n                                return null;\n                            }\n                        }\n                    } else {\n                        return null;\n                    }\n                }\n            }\n\n            /**\n             * `fnProcess` to call `_fnCheck`. If `condition` is `array` then call `for_each_filter`\n             * else will call `_fnCheck`. Specical `condition.field` is `_$` then apply `condition.callback` for all field, if have `field` invaild then `return true`.\n             *\n             * @param node\n             * @param condition\n             * @param isAnd\n             * @returns {null|boolean}\n             * @private\n             */\n            function _fnProccess(node, condition, isAnd) {\n                if (angular.isArray(condition)) {\n                    return for_each_filter(node, condition, isAnd);\n                } else {\n                    var _key      = condition.field,\n                        _callback = condition.callback,\n                        _iO, _keysO, _lenO;\n\n                    if (_key === '_$') {\n                        _keysO = Object.keys(node);\n                        _lenO  = _keysO.length;\n                        for (_iO = 0; _iO < _lenO; _iO++) {\n                            if (_fnCheck(_callback, node[_keysO[_iO]])) {\n                                return true;\n                            }\n                        }\n                    } else if (angular.isDefined(node[_key])) {\n                        return _fnCheck(_callback, node[_key]);\n                    }\n                }\n                return null;\n            }\n\n            /**\n             *\n             * @param {object} node\n             * @param {array} conditions Array `conditions`\n             * @param {boolean} isAnd check with condition `And`, if `And` then `return false` when all `false`\n             * @returns {null|boolean}\n             */\n            function for_each_filter(node, conditions, isAnd) {\n                var i, len = conditions.length || 0, passed = false;\n                if (len === 0) {\n                    return null;\n                }\n\n                for (i = 0; i < len; i++) {\n                    if (_fnProccess(node, conditions[i], !isAnd)) {\n                        passed = true;\n                        // if condition `or` then return;\n                        if (!isAnd) {\n                            return true;\n                        }\n                    } else {\n\n                        // if condition `and` and result in fnProccess = false then return;\n                        if (isAnd) {\n                            return false;\n                        }\n                    }\n                }\n\n                return passed;\n            }\n\n            /**\n             * Will call _fnAfter to clear data no need\n             * @param {object} options\n             * @param {object} node\n             * @param {boolean} isNodePassed\n             * @param {boolean} isChildPassed\n             * @param {boolean} isParentPassed\n             * @private\n             */\n            function _fnAfter(options, node, isNodePassed, isChildPassed, isParentPassed) {\n                if (isNodePassed === true) {\n                    node.__filtered__         = true;\n                    node.__filtered_visible__ = true;\n                    node.__filtered_index__ = options.filter_index++;\n                    return; //jmp\n                } else if (isChildPassed === true && options.showParent === true\n                           || isParentPassed === true && options.showChild === true) {\n                    node.__filtered__         = false;\n                    node.__filtered_visible__ = true;\n                    node.__filtered_index__ = options.filter_index++;\n                    return; //jmp\n                }\n\n                // remove attr __filtered__\n                delete node.__filtered__;\n                delete node.__filtered_visible__;\n                delete node.__filtered_index__;\n            }\n\n            /**\n             * `fnBefore` will called when `for_all_descendants` of `node` checking.\n             * If `filter` empty then return `true` else result of function `_fnProccess` {@see _fnProccess}\n             *\n             * @param {object} options\n             * @param {object} node\n             * @returns {null|boolean}\n             * @private\n             */\n            function _fnBefore(options, node) {\n                if (options.filter.length === 0) {\n                    return true;\n                } else {\n                    return _fnProccess(node, options.filter, options.beginAnd || false);\n                }\n            }\n\n            /**\n             * `fnBeforeClear` will called when `for_all_descendants` of `node` checking.\n             * Alway false to Clear Filter empty\n             *\n             * @param {object} options\n             * @param {object} node\n             * @returns {null|boolean}\n             * @private\n             */\n            function _fnBeforeClear(options, node) {\n                return false;\n            }\n\n            /**\n             * `_fnConvert` to convert `filter` `object` to `array` invaild.\n             *\n             * @param {object|array} filters\n             * @returns {array} Instead of `filter` or new array invaild *(converted from filter)*\n             * @private\n             */\n            function _fnConvert(filters) {\n                var _iF, _lenF, _keysF,\n                    _filter,\n                    _state;\n                // convert filter object to array filter\n                if (angular.isObject(filters) && !angular.isArray(filters)) {\n                    _keysF  = Object.keys(filters);\n                    _lenF   = _keysF.length;\n                    _filter = [];\n\n                    if (_lenF > 0) {\n                        for (_iF = 0; _iF < _lenF; _iF++) {\n\n                            if (typeof filters[_keysF[_iF]] === 'string' && filters[_keysF[_iF]].length === 0) {\n                                continue;\n                            } else if (angular.isArray(filters[_keysF[_iF]])) {\n                                _state = filters[_keysF[_iF]];\n                            } else if (angular.isObject(filters[_keysF[_iF]])) {\n                                _state = _fnConvert(filters[_keysF[_iF]]);\n                            } else {\n                                _state = {\n                                    field:    _keysF[_iF],\n                                    callback: filters[_keysF[_iF]]\n                                };\n                            }\n                            _filter.push(_state);\n                        }\n                    }\n                    _state = null;\n                    return _filter;\n                }\n                else {\n                    return filters;\n                }\n            }\n\n            /**\n             * `fnInitFilter` function is constructor of service `$TreeDnDFilter`.\n             * @constructor\n             * @param {object|array} treeData\n             * @param {object|array} filters\n             * @param {object} options\n             * @param {string} keyChild\n             * @returns {array} Return `treeData` or `treeData` with `filter`\n             * @private\n             */\n            function fnInitFilter(treeData, filters, options, keyChild) {\n                if (!angular.isArray(treeData)\n                    || treeData.length === 0) {\n                    return treeData;\n                }\n\n                var _i, _len,\n                    _filter;\n\n                _filter = _fnConvert(filters);\n                if (!(angular.isArray(_filter) || angular.isObject(_filter))\n                    || _filter.length === 0) {\n                    for (_i = 0, _len = treeData.length; _i < _len; _i++) {\n                        for_all_descendants(\n                            options,\n                            treeData[_i],\n                            keyChild || '__children__',\n                            _fnBeforeClear, _fnAfter\n                        );\n                    }\n                    return treeData;\n                }\n\n                options.filter = _filter;\n                options.filter_index = 0;\n                for (_i = 0, _len = treeData.length; _i < _len; _i++) {\n                    for_all_descendants(\n                        options,\n                        treeData[_i],\n                        keyChild || '__children__',\n                        _fnBefore, _fnAfter\n                    );\n                }\n\n                return treeData;\n            }\n\n        }]\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDOrderBy', [\n        '$filter', function ($filter) {\n            var _fnOrderBy = $filter('orderBy'),\n                for_all_descendants = function for_all_descendants(options, node, name, fnOrderBy) {\n                    var _i, _len, _nodes;\n\n                    if (angular.isDefined(node[name])) {\n                        _nodes = node[name];\n                        _len = _nodes.length;\n                        // OrderBy children\n                        for (_i = 0; _i < _len; _i++) {\n                            _nodes[_i] = for_all_descendants(options, _nodes[_i], name, fnOrderBy);\n                        }\n\n                        node[name] = fnOrderBy(node[name], options);\n                    }\n                    return node;\n                },\n                _fnOrder = function _fnOrder(list, orderBy) {\n                    return _fnOrderBy(list, orderBy);\n                },\n                _fnMain = function _fnMain(treeData, orderBy) {\n                    if (!angular.isArray(treeData)\n                        || treeData.length === 0\n                        || !(angular.isArray(orderBy) || angular.isObject(orderBy) || angular.isString(orderBy) || angular.isFunction(orderBy))\n                        || orderBy.length === 0 && !angular.isFunction(orderBy)) {\n                        return treeData;\n                    }\n\n                    var _i, _len;\n\n                    for (_i = 0, _len = treeData.length; _i < _len; _i++) {\n                        treeData[_i] = for_all_descendants(\n                            orderBy,\n                            treeData[_i],\n                            '__children__',\n                            _fnOrder\n                        );\n                    }\n\n                    return _fnOrder(treeData, orderBy);\n                };\n\n            return _fnMain;\n        }]\n);\n\nangular.module('ntt.TreeDnD')\n       .factory(\n           '$TreeDnDConvert', function () {\n               var _$initConvert = {\n                   line2tree: function (data, primaryKey, parentKey, callback) {\n                       callback = typeof callback === 'function' ? callback : function () {\n                       };\n                       if (!data || data.length === 0 || !primaryKey || !parentKey) {\n                           return [];\n                       }\n                       var tree     = [],\n                           rootIds  = [],\n                           item     = data[0],\n                           _primary = item[primaryKey],\n                           treeObjs = {},\n                           parentId, parent,\n                           len      = data.length,\n                           i        = 0;\n                       while (i < len) {\n                           item = data[i++];\n                           callback(item);\n                           _primary           = item[primaryKey];\n                           treeObjs[_primary] = item;\n                       }\n                       i = 0;\n                       while (i < len) {\n                           item = data[i++];\n                           callback(item);\n                           _primary           = item[primaryKey];\n                           treeObjs[_primary] = item;\n                           parentId           = item[parentKey];\n                           if (parentId) {\n                               parent = treeObjs[parentId];\n                               if (parent) {\n                                   if (parent.__children__) {\n                                       parent.__children__.push(item);\n                                   } else {\n                                       parent.__children__ = [item];\n                                   }\n                               }\n                           } else {\n                               rootIds.push(_primary);\n                           }\n                       }\n                       len = rootIds.length;\n                       for (i = 0; i < len; i++) {\n                           tree.push(treeObjs[rootIds[i]]);\n                       }\n                       return tree;\n                   },\n                   tree2tree: function access_child(data, containKey, callback) {\n                       callback  = typeof callback === 'function' ? callback : function () {\n                       };\n                       var _tree = [],\n                           _i,\n                           _len  = data ? data.length : 0,\n                           _copy, _child;\n                       for (_i = 0; _i < _len; _i++) {\n                           _copy = angular.copy(data[_i]);\n                           callback(_copy);\n                           if (angular.isArray(_copy[containKey]) && _copy[containKey].length > 0) {\n                               _child = access_child(_copy[containKey], containKey, callback);\n                               delete _copy[containKey];\n                               _copy.__children__ = _child;\n                           }\n                           _tree.push(_copy);\n                       }\n                       return _tree;\n                   }\n               };\n\n               return _$initConvert;\n           }\n       );\n\nangular.module('ntt.TreeDnD')\n       .factory(\n           '$TreeDnDHelper', [\n               '$document', '$window', function ($document, $window) {\n                   var _$helper = {\n                       nodrag:          function (targetElm) {\n                           return typeof targetElm.attr('data-nodrag') !== 'undefined';\n                       },\n                       eventObj:        function (e) {\n                           var obj = e;\n                           if (e.targetTouches !== undefined) {\n                               obj = e.targetTouches.item(0);\n                           } else if (e.originalEvent !== undefined && e.originalEvent.targetTouches !== undefined) {\n                               obj = e.originalEvent.targetTouches.item(0);\n                           }\n                           return obj;\n                       },\n                       dragInfo:        function (scope) {\n                           var _node   = scope.getData(),\n                               _tree   = scope.getScopeTree(),\n                               _parent = scope.getNode(_node.__parent_real__);\n                           return {\n                               node:    _node,\n                               nodes:    _tree.tree.get_selected_nodes(),\n                               parent:  _parent,\n                               move:    {\n                                   parent: _parent,\n                                   pos:    _node.__index__\n                               },\n                               scope:   scope,\n                               target:  _tree,\n                               drag:    _tree,\n                               drop:    scope.getPrevSibling(_node),\n                               changed: false\n                           };\n                       },\n                       height:          function (element) {\n                           return element.prop('scrollHeight');\n                       },\n                       width:           function (element) {\n                           return element.prop('scrollWidth');\n                       },\n                       offset:          function (element) {\n                           var boundingClientRect = element[0].getBoundingClientRect();\n                           return {\n                               width:  element.prop('offsetWidth'),\n                               height: element.prop('offsetHeight'),\n                               top:    boundingClientRect.top + ($window.pageYOffset || $document[0].body.scrollTop || $document[0].documentElement.scrollTop),\n                               left:   boundingClientRect.left + ($window.pageXOffset || $document[0].body.scrollLeft || $document[0].documentElement.scrollLeft)\n                           };\n                       },\n                       positionStarted: function (e, target) {\n                           var pos     = {};\n                           pos.offsetX = e.pageX - this.offset(target).left;\n                           pos.offsetY = e.pageY - this.offset(target).top;\n                           pos.startX  = pos.lastX = e.pageX;\n                           pos.startY = pos.lastY = e.pageY;\n                           pos.nowX = pos.nowY = pos.distX = pos.distY = pos.dirAx = 0;\n                           pos.dirX = pos.dirY = pos.lastDirX = pos.lastDirY = pos.distAxX = pos.distAxY = 0;\n                           return pos;\n                       },\n                       positionMoved:   function (e, pos, firstMoving) {\n                           // mouse position last events\n                           pos.lastX    = pos.nowX;\n                           pos.lastY    = pos.nowY;\n                           // mouse position this events\n                           pos.nowX     = e.pageX;\n                           pos.nowY     = e.pageY;\n                           // distance mouse moved between events\n                           pos.distX    = pos.nowX - pos.lastX;\n                           pos.distY    = pos.nowY - pos.lastY;\n                           // direction mouse was moving\n                           pos.lastDirX = pos.dirX;\n                           pos.lastDirY = pos.dirY;\n                           // direction mouse is now moving (on both axis)\n                           pos.dirX     = pos.distX === 0 ? 0 : pos.distX > 0 ? 1 : -1;\n                           pos.dirY     = pos.distY === 0 ? 0 : pos.distY > 0 ? 1 : -1;\n                           // axis mouse is now moving on\n                           var newAx    = Math.abs(pos.distX) > Math.abs(pos.distY) ? 1 : 0;\n                           // do nothing on first move\n                           if (firstMoving) {\n                               pos.dirAx  = newAx;\n                               pos.moving = true;\n                               return;\n                           }\n                           // calc distance moved on this axis (and direction)\n                           if (pos.dirAx !== newAx) {\n                               pos.distAxX = 0;\n                               pos.distAxY = 0;\n                           } else {\n                               pos.distAxX += Math.abs(pos.distX);\n                               if (pos.dirX !== 0 && pos.dirX !== pos.lastDirX) {\n                                   pos.distAxX = 0;\n                               }\n                               pos.distAxY += Math.abs(pos.distY);\n                               if (pos.dirY !== 0 && pos.dirY !== pos.lastDirY) {\n                                   pos.distAxY = 0;\n                               }\n                           }\n                           pos.dirAx = newAx;\n                       },\n                       replaceIndent:   function (scope, element, indent, attr) {\n                           attr = attr || 'left';\n                           angular.element(element.children()[0]).css(attr, scope.$callbacks.calsIndent(indent));\n                       }\n                   };\n                   return _$helper;\n               }]\n       );\n\nangular.module('ntt.TreeDnD')\n       .factory(\n           '$TreeDnDPlugin', ['$injector', function ($injector) {\n               var _fnget = function (name) {\n                   if (angular.isDefined($injector) && $injector.has(name)) {\n                       return $injector.get(name);\n                   }\n                   return null;\n               };\n               return _fnget;\n           }]\n       );\n\nangular.module('ntt.TreeDnD')\n       .factory(\n           '$TreeDnDTemplate', [\n               '$templateCache', function ($templateCache) {\n                   var templatePath = 'template/TreeDnD/TreeDnD.html',\n                       copyPath     = 'template/TreeDnD/TreeDnDStatusCopy.html',\n                       movePath     = 'template/TreeDnD/TreeDnDStatusMove.html',\n                       scopes       = {},\n                       temp,\n                       _$init       = {\n                           setMove: function (path, scope) {\n                               if (!scopes[scope.$id]) {\n                                   scopes[scope.$id] = {};\n                               }\n                               scopes[scope.$id].movePath = path;\n                           },\n                           setCopy: function (path, scope) {\n                               if (!scopes[scope.$id]) {\n                                   scopes[scope.$id] = {};\n                               }\n                               scopes[scope.$id].copyPath = path;\n                           },\n                           getPath: function () {\n                               return templatePath;\n                           },\n                           getCopy: function (scope) {\n                               if (scopes[scope.$id] && scopes[scope.$id].copyPath) {\n                                   temp = $templateCache.get(scopes[scope.$id].copyPath);\n                                   if (temp) {\n                                       return temp;\n                                   }\n                               }\n                               return $templateCache.get(copyPath);\n                           },\n                           getMove: function (scope) {\n                               if (scopes[scope.$id] && scopes[scope.$id].movePath) {\n                                   temp = $templateCache.get(scopes[scope.$id].movePath);\n                                   if (temp) {\n                                       return temp;\n                                   }\n                               }\n                               return $templateCache.get(movePath);\n                           }\n                       };\n\n                   return _$init;\n               }]\n       );\n\nangular.module('ntt.TreeDnD')\n    .factory('$TreeDnDViewport', fnInitTreeDnDViewport);\n\nfnInitTreeDnDViewport.$inject = ['$window', '$document', '$timeout', '$q', '$compile'];\n\nfunction fnInitTreeDnDViewport($window, $document, $timeout, $q, $compile) {\n\n    var viewport      = null,\n        isUpdating    = false,\n        isRender      = false,\n        updateAgain   = false,\n        viewportRect,\n        items         = [],\n        nodeTemplate,\n        updateTimeout,\n        renderTime,\n        $initViewport = {\n            setViewport:   setViewport,\n            getViewport:   getViewport,\n            add:           add,\n            setTemplate:   setTemplate,\n            getItems:      getItems,\n            updateDelayed: updateDelayed\n        },\n        eWindow       = angular.element($window);\n\n    eWindow.on('load resize scroll', updateDelayed);\n\n    return $initViewport;\n\n    function update() {\n\n        viewportRect = {\n            width:  eWindow.prop('offsetWidth') || document.documentElement.clientWidth,\n            height: eWindow.prop('offsetHeight') || document.documentElement.clientHeight,\n            top:    $document[0].body.scrollTop || $document[0].documentElement.scrollTop,\n            left:   $document[0].body.scrollLeft || $document[0].documentElement.scrollLeft\n        };\n\n        if (isUpdating || isRender) {\n            updateAgain = true;\n            return;\n        }\n        isUpdating = true;\n\n        recursivePromise();\n    }\n\n    function recursivePromise() {\n        if (isRender) {\n            return;\n        }\n\n        var number = number > 0 ? number : items.length, item;\n\n        if (number > 0) {\n            item = items[0];\n\n            isRender   = true;\n            renderTime = $timeout(function () {\n                //item.element.html(nodeTemplate);\n                //$compile(item.element.contents())(item.scope);\n\n                items.splice(0, 1);\n                isRender = false;\n                number--;\n                $timeout.cancel(renderTime);\n                recursivePromise();\n            }, 0);\n\n        } else {\n            isUpdating = false;\n            if (updateAgain) {\n                updateAgain = false;\n                update();\n            }\n        }\n\n    }\n\n    /**\n     * Check if a point is inside specified bounds\n     * @param x\n     * @param y\n     * @param bounds\n     * @returns {boolean}\n     */\n    function pointIsInsideBounds(x, y, bounds) {\n        return x >= bounds.left &&\n               y >= bounds.top &&\n               x <= bounds.left + bounds.width &&\n               y <= bounds.top + bounds.height;\n    }\n\n    /**\n     * @name setViewport\n     * @desciption Set the viewport element\n     * @param element\n     */\n    function setViewport(element) {\n        viewport = element;\n    }\n\n    /**\n     * Return the current viewport\n     * @returns {*}\n     */\n    function getViewport() {\n        return viewport;\n    }\n\n    /**\n     * trigger an update\n     */\n    function updateDelayed() {\n        $timeout.cancel(updateTimeout);\n        updateTimeout = $timeout(function () {\n            update();\n        }, 0);\n    }\n\n    /**\n     * Add listener for event\n     * @param element\n     * @param callback\n     */\n    function add(scope, element) {\n        updateDelayed();\n        items.push({\n            element: element,\n            scope:   scope\n        });\n    }\n\n    function setTemplate(scope, template) {\n        nodeTemplate = template;\n    }\n\n    /**\n     * Get list of items\n     * @returns {Array}\n     */\n    function getItems() {\n        return items;\n    }\n}\n\nangular.module('ntt.TreeDnD')\r\n    .factory(\r\n    '$TreeDnDDrag', [\r\n        '$timeout', '$TreeDnDHelper',\r\n        function ($timeout, $TreeDnDHelper) {\r\n            function _fnPlaceHolder(e, $params) {\r\n                if ($params.placeElm) {\r\n                    var _offset = $TreeDnDHelper.offset($params.placeElm);\r\n                    if (_offset.top <= e.pageY && e.pageY <= _offset.top + _offset.height &&\r\n                        _offset.left <= e.pageX && e.pageX <= _offset.left + _offset.width\r\n                    ) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            }\r\n\r\n            function _fnDragStart(e, $params) {\r\n                \r\n                if (!$params.hasTouch && (e.button === 2 || e.which === 3 || e.metaKey || e.shiftKey)) {\r\n                  // disable right click\r\n                  return;\r\n                }\r\n                if (e.uiTreeDragging || e.originalEvent && e.originalEvent.uiTreeDragging) { // event has already fired in other scope.\r\n                  return;\r\n                }\r\n                // the element which is clicked.\r\n                var eventElm = angular.element(e.target);\r\n                var eventScope = eventElm.scope();\r\n                if (!eventScope || !eventScope.$type) {\r\n                  return;\r\n                }\r\n                // if (eventScope.$type !== 'TreeDnDNode') { // Check if it is a node or a handle\r\n                //     return;\r\n                // }\r\n\r\n                if (eventScope.$type !== 'TreeDnDNodeHandle') { // If the node has a handle, then it should be clicked by the handle\r\n                  return;\r\n                }\r\n\r\n                var eventElmTagName = eventElm.prop('tagName').toLowerCase(),\r\n                    dragScope,\r\n                    _$scope = $params.$scope;\r\n                if (eventElmTagName === 'input'\r\n                    || eventElmTagName === 'textarea'\r\n                    || eventElmTagName === 'button'\r\n                    || eventElmTagName === 'select') { // if it's a input or button, ignore it\r\n                  return;\r\n                }\r\n                // check if it or it's parents has a 'data-nodrag' attribute\r\n                while (eventElm && eventElm[0] && eventElm[0] !== $params.element) {\r\n                  if ($TreeDnDHelper.nodrag(eventElm)) { // if the node mark as `nodrag`, DONOT drag it.\r\n                    return;\r\n                  }\r\n                  eventElm = eventElm.parent();\r\n                }\r\n\r\n                e.uiTreeDragging = true; // stop event bubbling\r\n                if (e.originalEvent) {\r\n                  e.originalEvent.uiTreeDragging = true;\r\n                }\r\n                e.preventDefault();\r\n\r\n                dragScope = eventScope.getScopeNode();\r\n\r\n                $params.firstMoving = true;\r\n\r\n                if (!_$scope.$callbacks.beforeDrag(dragScope)) {\r\n                  return;\r\n                }\r\n\r\n                var eventObj = $TreeDnDHelper.eventObj(e),\r\n                    tagName = dragScope.$element.prop('tagName').toLowerCase(),\r\n                    isTable = tagName === 'tr';\r\n\r\n                $params.dragInfo = $TreeDnDHelper.dragInfo(dragScope);\r\n\r\n                _$scope.setDragging($params.dragInfo);\r\n\r\n                $params.pos = $TreeDnDHelper.positionStarted(eventObj, dragScope.$element);\r\n\r\n                if (isTable) {\r\n                  $params.dragElm = angular.element($params.$window.document.createElement('table'))\r\n                      .addClass(_$scope.$class.tree)\r\n                      .addClass(_$scope.$class.drag)\r\n                      .addClass(_$scope.$tree_class);\r\n                } else {\r\n                  $params.dragElm = angular.element($params.$window.document.createElement('ul'))\r\n                  .addClass(_$scope.$class.hidden);\r\n                }\r\n\r\n                $params.dragElm.css(\r\n                    {\r\n                      'width':   $TreeDnDHelper.width(dragScope.$element) + 'px',\r\n                      'z-index': 9995\r\n                    }\r\n                );\r\n\r\n                $params.offsetEdge = 0;\r\n                var _width = $TreeDnDHelper.width(dragScope.$element),\r\n                    _scope = dragScope,\r\n                    _element = _scope.$element,\r\n                    _clone = null,\r\n                    _needCollapse = !!_$scope.enabledCollapse,\r\n                    _copied = false,\r\n                    _tbody = null;\r\n\r\n                if (isTable) {\r\n                  $params.offsetEdge = $params.dragInfo.node.__level__ - 1;\r\n                  _tbody = angular.element($params.$window.document.createElement('tbody'));\r\n\r\n                  _$scope.for_all_descendants(\r\n                      $params.dragInfo.node, function (_node) {\r\n                        _scope = _$scope.getScope(_node);\r\n                        _element = _scope.$element;\r\n\r\n                        if (!_copied) {\r\n                          _clone = _element.clone();\r\n\r\n                          $TreeDnDHelper.replaceIndent(\r\n                              _scope,\r\n                              _clone,\r\n                              _node.__level__ - $params.offsetEdge,\r\n                              'padding-left'\r\n                          );\r\n\r\n                          _tbody.append(_clone);\r\n\r\n                          // skip all, just clone parent\r\n                          if (_needCollapse) {\r\n                            _copied = true;\r\n                          }\r\n                        }\r\n\r\n                        if (_$scope.enabledMove && _$scope.$class.hidden) {\r\n                          _element.addClass(_$scope.$class.hidden);\r\n                        }\r\n                      }\r\n                  );\r\n\r\n                  $params.dragElm.append(_tbody);\r\n                } \r\n\r\n                $params.dragElm.css(\r\n                    {\r\n                      'left': eventObj.pageX - $params.pos.offsetX + _$scope.$callbacks.calsIndent(\r\n                          $params.offsetEdge + 1,\r\n                          true,\r\n                          true\r\n                      )       + 'px',\r\n                      'top':  eventObj.pageY - $params.pos.offsetY + 'px'\r\n                    }\r\n                );\r\n                // moving item with descendant\r\n                $params.$document.find('body').append($params.dragElm);\r\n                if (_$scope.$callbacks.droppable()) {\r\n                  $params.placeElm = _$scope.initPlace(dragScope.$element, $params.dragElm);\r\n\r\n                  if (isTable) {\r\n                    $TreeDnDHelper.replaceIndent(_$scope, $params.placeElm, $params.dragInfo.node.__level__);\r\n                  }\r\n\r\n                  $params.placeElm.css('width', _width);\r\n                }\r\n\r\n                _$scope.hidePlace();\r\n                _$scope.targeting = true;\r\n\r\n                if (_$scope.enabledStatus) {\r\n                  _$scope.refreshStatus();\r\n                  _$scope.setPositionStatus(e);\r\n                }\r\n\r\n                angular.element($params.$document).bind('touchend', $params.dragEndEvent);\r\n                angular.element($params.$document).bind('touchcancel', $params.dragEndEvent);\r\n                angular.element($params.$document).bind('touchmove', $params.dragMoveEvent);\r\n                angular.element($params.$document).bind('mouseup', $params.dragEndEvent);\r\n                angular.element($params.$document).bind('mousemove', $params.dragMoveEvent);\r\n                angular.element($params.$document).bind('mouseleave', $params.dragCancelEvent);\r\n\r\n                $params.document_height = Math.max(\r\n                    $params.body.scrollHeight,\r\n                    $params.body.offsetHeight,\r\n                    $params.html.clientHeight,\r\n                    $params.html.scrollHeight,\r\n                    $params.html.offsetHeight\r\n                );\r\n\r\n                $params.document_width = Math.max(\r\n                    $params.body.scrollWidth,\r\n                    $params.body.offsetWidth,\r\n                    $params.html.clientWidth,\r\n                    $params.html.scrollWidth,\r\n                    $params.html.offsetWidth\r\n                );\r\n            }\r\n\r\n            function _fnDragMove (e, $params) {\r\n                var _$scope = $params.$scope;\r\n                if (!$params.dragStarted) {\r\n                  if (!$params.dragDelaying) {\r\n                    $params.dragStarted = true;\r\n                    _$scope.$safeApply(\r\n                        function () {\r\n                          _$scope.$callbacks.dragStart($params.dragInfo);\r\n                        }\r\n                    );\r\n                  }\r\n                  return;\r\n                }\r\n\r\n                if ($params.dragElm) {\r\n                  e.preventDefault();\r\n                  if ($params.$window.getSelection) {\r\n                    $params.$window.getSelection().removeAllRanges();\r\n                  } else if ($params.$window.document.selection) {\r\n                    $params.$window.document.selection.empty();\r\n                  }\r\n\r\n                  var eventObj = $TreeDnDHelper.eventObj(e),\r\n                      leftElmPos = eventObj.pageX - $params.pos.offsetX,\r\n                      topElmPos = eventObj.pageY - $params.pos.offsetY;\r\n\r\n                  //dragElm can't leave the screen on the left\r\n                  if (leftElmPos < 0) {\r\n                    leftElmPos = 0;\r\n                  }\r\n\r\n                  //dragElm can't leave the screen on the top\r\n                  if (topElmPos < 0) {\r\n                    topElmPos = 0;\r\n                  }\r\n\r\n                  //dragElm can't leave the screen on the bottom\r\n                  if (topElmPos + 10 > $params.document_height) {\r\n                    topElmPos = $params.document_height - 10;\r\n                  }\r\n\r\n                  //dragElm can't leave the screen on the right\r\n                  if (leftElmPos + 10 > $params.document_width) {\r\n                    leftElmPos = $params.document_width - 10;\r\n                  }\r\n\r\n                  $params.dragElm.css(\r\n                      {\r\n                        'left': leftElmPos + _$scope.$callbacks.calsIndent(\r\n                            $params.offsetEdge + 1,\r\n                            true,\r\n                            true\r\n                        )       + 'px',\r\n                        'top':  topElmPos + 'px'\r\n                      }\r\n                  );\r\n\r\n                  if (_$scope.enabledStatus) {\r\n                    _$scope.setPositionStatus(e);\r\n                  }\r\n\r\n                  var top_scroll = window.pageYOffset || $params.$window.document.documentElement.scrollTop,\r\n                      bottom_scroll = top_scroll + (window.innerHeight || $params.$window.document.clientHeight || $params.$window.document.clientHeight);\r\n                  // to scroll down if cursor y-position is greater than the bottom position the vertical scroll\r\n                  if (bottom_scroll < eventObj.pageY && bottom_scroll <= $params.document_height) {\r\n                    window.scrollBy(0, 10);\r\n                  }\r\n                  // to scroll top if cursor y-position is less than the top position the vertical scroll\r\n                  if (top_scroll > eventObj.pageY) {\r\n                    window.scrollBy(0, -10);\r\n                  }\r\n\r\n                  $TreeDnDHelper.positionMoved(e, $params.pos, $params.firstMoving);\r\n\r\n                  if ($params.firstMoving) {\r\n                    $params.firstMoving = false;\r\n                    return;\r\n                  }\r\n                  // check if add it as a child node first\r\n\r\n                  var targetX = eventObj.pageX - $params.$window.document.body.scrollLeft,\r\n                      targetY = eventObj.pageY - (window.pageYOffset || $params.$window.document.documentElement.scrollTop),\r\n\r\n                      targetElm,\r\n                      targetScope,\r\n                      targetBefore,\r\n                      targetInside,\r\n                      targetOffset,\r\n                      tagName,\r\n                      isTable,\r\n                      isChanged = true,\r\n                      isVeritcal = true,\r\n                      isEmpty,\r\n                      isSwapped,\r\n                      _scope,\r\n                      _target,\r\n                      _parent,\r\n                      _info = $params.dragInfo,\r\n                      _move = _info.move,\r\n                      _drag = _info.node,\r\n                      _drop = _info.drop,\r\n                      treeScope = _info.target,\r\n                      fnSwapTree,\r\n                      isHolder = _fnPlaceHolder(e, $params);\r\n\r\n                  if (!isHolder) {\r\n                    /* when using elementFromPoint() inside an iframe, you have to call\r\n                     elementFromPoint() twice to make sure IE8 returns the correct value\r\n                     $params.$window.document.elementFromPoint(targetX, targetY);*/\r\n\r\n                    targetElm = angular.element(\r\n                        $params.$window.document.elementFromPoint(\r\n                            targetX,\r\n                            targetY\r\n                        )\r\n                    );\r\n\r\n                    targetScope = targetElm.scope();\r\n                    if (!targetScope) {\r\n                      return;\r\n                    }\r\n\r\n                    fnSwapTree = function () {\r\n                      treeScope = targetScope.getScopeTree();\r\n                      _target = _info.target;\r\n                      if (_info.target !== treeScope) {\r\n                        if (treeScope.$callbacks.droppable()) {\r\n                          // Replace by place-holder new\r\n                          _target.hidePlace();\r\n                          _target.targeting = false;\r\n                          treeScope.targeting = true;\r\n\r\n                          _info.target = treeScope;\r\n                          $params.placeElm = treeScope.initPlace(targetScope.$element, $params.dragElm);\r\n\r\n                          _target = null;\r\n                          isSwapped = true;\r\n                        } else {\r\n                          // Not allowed Drop Item\r\n                          return false;\r\n                        }\r\n                      }\r\n                      return true;\r\n                    };\r\n\r\n                    if (angular.isFunction(targetScope.getScopeNode)) {\r\n                      targetScope = targetScope.getScopeNode();\r\n                      if (!fnSwapTree()) {\r\n                        return;\r\n                      }\r\n                    } else {\r\n                      if (targetScope.$type === 'TreeDnDNodes' || targetScope.$type === 'TreeDnD') {\r\n                        if (targetScope.tree_nodes) {\r\n                          if (targetScope.tree_nodes.length === 0) {\r\n                            if (!fnSwapTree()) {\r\n                              return;\r\n                            }\r\n                            // Empty\r\n                            isEmpty = true;\r\n                          }\r\n                        } else {\r\n                          return;\r\n                        }\r\n                      } else {\r\n                        return;\r\n                      }\r\n                    }\r\n                  }\r\n\r\n                  if ($params.pos.dirAx && !isSwapped || isHolder) {\r\n                    isVeritcal = false;\r\n                    targetScope = _info.scope;\r\n                  }\r\n\r\n                  if (!targetScope.$element && !targetScope) {\r\n                    return;\r\n                  }\r\n\r\n                  tagName = targetScope.$element.prop('tagName').toLowerCase();\r\n                  isTable = tagName === 'tbody' || tagName === 'table' || tagName === 'tr' || tagName === 'td';\r\n                  if (isEmpty) {\r\n                    _move.parent = null;\r\n                    _move.pos = 0;\r\n\r\n                    _drop = null;\r\n                  } else {\r\n                    // move vertical\r\n                    if (isVeritcal) {\r\n                      targetElm = targetScope.$element; // Get the element of tree-dnd-node\r\n\r\n                      targetOffset = $TreeDnDHelper.offset(targetElm);\r\n\r\n                      if (targetScope.horizontal && !isTable) {\r\n                        targetBefore = eventObj.pageX < targetOffset.left + $TreeDnDHelper.width(targetElm) / 2;\r\n                      } else {\r\n                        if (isTable) {\r\n                          targetBefore = eventObj.pageY < targetOffset.top + $TreeDnDHelper.height(targetElm) / 2;\r\n                        } else {\r\n                          var _height = $TreeDnDHelper.height(targetElm);\r\n\r\n                          if (targetScope.getElementChilds()) {\r\n                            _height -= $TreeDnDHelper.height(targetScope.getElementChilds());\r\n                          }\r\n\r\n                          if (eventObj.pageY > targetOffset.top + _height) {\r\n                            return;\r\n                          }\r\n                          targetBefore = eventObj.pageY < targetOffset.top + _height * 0.5;\r\n                          targetInside = eventObj.pageY > targetOffset.top + _height * 0.25 &&\r\n                              eventObj.pageY < targetOffset.top + _height * 0.75;\r\n                        }\r\n                      }\r\n\r\n                      if (!angular.isFunction(targetScope.getData)) {\r\n                        return;\r\n                      }\r\n\r\n                      _target = targetScope.getData();\r\n                      _parent = targetScope.getNode(_target.__parent_real__);\r\n\r\n                      if(_target.groupId && targetInside) {\r\n                        _move.parent = _target;\r\n                        _move.pos = 0;\r\n                        _drop = null;\r\n                      } else if (targetBefore) {\r\n                        var _prev = targetScope.getPrevSibling(_target);\r\n\r\n                        _move.parent = _parent;\r\n                        _move.pos = angular.isDefined(_prev) ? _prev.__index__ + 1: 0;\r\n\r\n                        _drop = _prev;\r\n                      } else {\r\n                        if (_target.__expanded__ && !(_target.__children__.length === 1 && _target.__index_real__ === _drag.__parent_real__)) {\r\n                          _move.parent = _target;\r\n                          _move.pos = 0;\r\n\r\n                          _drop = null;\r\n                        } else {\r\n                          _move.parent = _parent;\r\n                          _move.pos = _target.__index__ + 1;\r\n\r\n                          _drop = _target;\r\n                        }\r\n                      }\r\n                    } else {\r\n                      // move horizontal\r\n                      if ($params.pos.dirAx && $params.pos.distAxX >= treeScope.dragBorder) {\r\n                        $params.pos.distAxX = 0;\r\n                        // increase horizontal level if previous sibling exists and is not collapsed\r\n                        if ($params.pos.distX > 0) {\r\n                          _parent = _drop;\r\n                          if (!_parent) {\r\n                            if (_move.pos - 1 >= 0) {\r\n                              _parent = _move.parent.__children__[_move.pos - 1];\r\n                            } else {\r\n                              return;\r\n                            }\r\n                          }\r\n\r\n                          if (_info.drag === _info.target && _parent === _drag && _$scope.enabledMove) {\r\n                            _parent = treeScope.getPrevSibling(_parent);\r\n                          }\r\n\r\n                          if (_parent && _parent.__visible__) {\r\n                            var _len = _parent.__children__.length;\r\n\r\n                            _move.parent = _parent;\r\n                            _move.pos = _len;\r\n\r\n                            if (_len > 0) {\r\n                              _drop = _parent.__children__[_len - 1];\r\n                            } else {\r\n                              _drop = null;\r\n                            }\r\n                          } else {\r\n                            // Not changed\r\n                            return;\r\n                          }\r\n                        } else if ($params.pos.distX < 0) {\r\n                          _target = _move.parent;\r\n                          if (_target &&\r\n                              (_target.__children__.length === 0 ||\r\n                              _target.__children__.length - 1 < _move.pos ||\r\n                              _info.drag === _info.target &&\r\n                              _target.__index_real__ === _drag.__parent_real__ &&\r\n                              _target.__children__.length - 1 === _drag.__index__ && _$scope.enabledMove)\r\n                          ) {\r\n                            _parent = treeScope.getNode(_target.__parent_real__);\r\n\r\n                            _move.parent = _parent;\r\n                            _move.pos = _target.__index__ + 1;\r\n\r\n                            _drop = _target;\r\n                          } else {\r\n                            // Not changed\r\n                            return;\r\n                          }\r\n                        } else {\r\n                          return;\r\n                        }\r\n                      } else {\r\n                        // limited\r\n                        return;\r\n                      }\r\n                    }\r\n                  }\r\n\r\n                  if (_info.drag === _info.target &&\r\n                      _move.parent &&\r\n                      _drag.__parent_real__ === _move.parent.__index_real__ &&\r\n                      _drag.__index__ === _move.pos\r\n                  ) {\r\n                    isChanged = false;\r\n                  }\r\n\r\n                  if (treeScope.$callbacks.accept(_info, _move, isChanged)) {\r\n                    _info.move = _move;\r\n                    _info.drop = _drop;\r\n                    _info.changed = isChanged;\r\n                    _info.scope = targetScope;\r\n                    if (isTable) {\r\n                      $TreeDnDHelper.replaceIndent(\r\n                          treeScope,\r\n                          $params.placeElm,\r\n                          angular.isUndefinedOrNull(_move.parent) ? 1 : _move.parent.__level__ + 1\r\n                      );\r\n\r\n                      if (_drop) {\r\n                        _parent = (_move.parent ? _move.parent.__children__ : null ) || _info.target.treeData;\r\n                        if (_drop.__index__ < _parent.length - 1) {\r\n                          // Find fast\r\n                          _drop = _parent[_drop.__index__];\r\n                          _scope = _info.target.getScope(_drop);\r\n                          _scope.$element[0].parentNode.insertBefore(\r\n                              $params.placeElm[0],\r\n                              _scope.$element[0]\r\n                          );\r\n                        } else {\r\n                          _target = _info.target.getLastDescendant(_drop);\r\n                          _scope = _info.target.getScope(_target);\r\n                          _scope.$element.after($params.placeElm);\r\n                        }\r\n                      } else {\r\n                        _scope = _info.target.getScope(_move.parent);\r\n                        if (_scope) {\r\n                          if (_move.parent) {\r\n                            _scope.$element.after($params.placeElm);\r\n                            \r\n                          } else {\r\n                            _scope.getElementChilds().prepend($params.placeElm);\r\n                          }\r\n                        }\r\n                      }\r\n                    } else {\r\n                      _scope = _info.target.getScope(_drop || _move.parent);\r\n\r\n                      if ($params.lastParent) {\r\n                        $params.lastParent.removeClass('tree-dnd-dragover')\r\n                      }\r\n                      \r\n                      var shouldShowPlace = true;\r\n                      \r\n                      if (_drop) {\r\n                        _scope.$element.after($params.placeElm);\r\n                      } else {\r\n                        if (_move.parent) {\r\n                          $params.lastParent = _scope.$element;\r\n                          if (_move.parent.__expanded__) {\r\n                            _scope.getElementChilds().prepend($params.placeElm);\r\n                          } else {\r\n                            _scope.$element.addClass('tree-dnd-dragover');\r\n                            shouldShowPlace = false;\r\n                          }\r\n                        } else {\r\n                          _scope.getElementChilds().prepend($params.placeElm);\r\n                        }\r\n                      }\r\n                    }\r\n                    \r\n                    if (shouldShowPlace) {\r\n                      treeScope.showPlace()\r\n                    } else {\r\n                      treeScope.hidePlace();\r\n                    }\r\n\r\n                    _$scope.$safeApply(\r\n                        function () {\r\n                          _$scope.$callbacks.dragMove(_info);\r\n                        }\r\n                    );\r\n                  }\r\n\r\n                }\r\n              }\r\n\r\n            function _fnDragEnd(e, $params) {\r\n                e.preventDefault();\r\n                if ($params.dragElm) {\r\n                  var _passed = false,\r\n                      _$scope = $params.$scope,\r\n                      _scope = _$scope.getScope($params.dragInfo.node),\r\n                      tagName = _scope.$element.prop('tagName').toLowerCase(),\r\n                      _isTable = tagName === 'tr',\r\n                      _element = _scope.$element;\r\n\r\n                  _$scope.$safeApply(\r\n                      function () {\r\n                        _passed = _$scope.$callbacks.beforeDrop($params.dragInfo);\r\n                      }\r\n                  );\r\n\r\n                  // rollback all\r\n                  if ( _isTable ) {\r\n                    _$scope.for_all_descendants(\r\n                        $params.dragInfo.node, function (_node) {\r\n                          _scope = _$scope.getScope(_node);\r\n                          _element = _scope.$element;\r\n\r\n                          if (_scope.$class.hidden) {\r\n                            _element.removeClass(_$scope.$class.hidden);\r\n                          }\r\n                        }\r\n                    );\r\n                  } else {\r\n                    if (_$scope.$class.hidden) {\r\n                      _element.removeClass(_$scope.$class.hidden);\r\n                    }\r\n                  }\r\n\r\n                  $params.dragElm.remove();\r\n                  $params.dragElm = null;\r\n\r\n                  if ($params.lastParent) {\r\n                    $params.lastParent.removeClass('tree-dnd-dragover')\r\n                  }\r\n\r\n                  if (_$scope.enabledStatus) {\r\n                    _$scope.hideStatus();\r\n                  }\r\n\r\n                  var _status = false;\r\n                  if (_$scope.$$apply) {\r\n                    _$scope.$safeApply(\r\n                        function () {\r\n                          _status = _$scope.$callbacks.dropped(\r\n                              $params.dragInfo,\r\n                              _passed,\r\n                              _$scope.enabledMove\r\n                          );\r\n                        }\r\n                    );\r\n                  } else {\r\n                    _fnBindDrag($params);\r\n                  }\r\n\r\n                  _$scope.$safeApply(\r\n                      function () {\r\n                        _$scope.$callbacks.dragStop($params.dragInfo, _status);\r\n                      }\r\n                  );\r\n\r\n                  $params.dragInfo.target.hidePlace();\r\n                  $params.dragInfo.target.targeting = false;\r\n\r\n                  $params.dragInfo = null;\r\n                  _$scope.$$apply = false;\r\n                  _$scope.setDragging(null);\r\n                }\r\n\r\n                angular.element($params.$document).unbind('touchend', $params.dragEndEvent); // Mobile\r\n                angular.element($params.$document).unbind('touchcancel', $params.dragEndEvent); // Mobile\r\n                angular.element($params.$document).unbind('touchmove', $params.dragMoveEvent); // Mobile\r\n                angular.element($params.$document).unbind('mouseup', $params.dragEndEvent);\r\n                angular.element($params.$document).unbind('mousemove', $params.dragMoveEvent);\r\n                angular.element($params.$window.document.body).unbind('mouseleave', $params.dragCancelEvent);\r\n              }\r\n\r\n            function _fnDragStartEvent(e, $params) {\r\n                if ($params.$scope.$callbacks.draggable()) {\r\n                    _fnDragStart(e, $params);\r\n                }\r\n            }\r\n\r\n            function _fnBindDrag($params) {\r\n                $params.element.bind(\r\n                    'touchstart mousedown', function (e) {\r\n                        _fnDragStartEvent(e, $params);\r\n                        $params.dragDelaying = true;\r\n                        $params.dragStarted  = false;\r\n                        $params.dragTimer    = $timeout(\r\n                            function () {\r\n                                $params.dragDelaying = false;\r\n                            }, $params.$scope.dragDelay\r\n                        );\r\n                    }\r\n                );\r\n\r\n                $params.element.bind(\r\n                    'touchend touchcancel mouseup', function () {\r\n                        $timeout.cancel($params.dragTimer);\r\n                    }\r\n                );\r\n            }\r\n\r\n            function _fnKeydownHandler(e, $params) {\r\n                var _$scope = $params.$scope;\r\n                if (e.keyCode === 27) {\r\n                    if (_$scope.enabledStatus) {\r\n                        _$scope.hideStatus();\r\n                    }\r\n\r\n                    _$scope.$$apply = false;\r\n                    _fnDragEnd(e, $params);\r\n                } else {\r\n                    if (_$scope.enabledHotkey && e.shiftKey) {\r\n                        _$scope.enableMove(true);\r\n                        if (_$scope.enabledStatus) {\r\n                            _$scope.refreshStatus();\r\n                        }\r\n\r\n                        if (!$params.dragInfo) {\r\n                            return;\r\n                        }\r\n\r\n                        var _scope   = _$scope.getScope($params.dragInfo.node),\r\n                            _element = _scope.$element;\r\n\r\n                        if (_scope.isTable) {\r\n                            _$scope.for_all_descendants(\r\n                                $params.dragInfo.node, function (_node, _parent) {\r\n                                    _scope   = _$scope.getScope(_node);\r\n                                    _element = _scope && _scope.$element;\r\n                                    if (_scope && _element && (!_parent && _node.__visible__ || _parent.__expanded__)) {\r\n                                        if (_$scope.$class.hidden) {\r\n                                            _element.addClass(_$scope.$class.hidden);\r\n                                        }\r\n                                    }\r\n                                    return _node.__visible__ === false || _node.__expanded__ === false\r\n\r\n                                }, null, true\r\n                            );\r\n                        } else {\r\n                            if (_$scope.$class.hidden) {\r\n                                _element.addClass(_$scope.$class.hidden);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            function _fnKeyupHandler(e, $params) {\r\n                var _$scope = $params.$scope;\r\n                if (_$scope.enabledHotkey && !e.shiftKey) {\r\n                    _$scope.enableMove(false);\r\n\r\n                    if (_$scope.enabledStatus) {\r\n                        _$scope.refreshStatus();\r\n                    }\r\n\r\n                    if (!$params.dragInfo) {\r\n                        return;\r\n                    }\r\n\r\n                    var _scope   = _$scope.getScope($params.dragInfo.node),\r\n                        _element = _scope.$element;\r\n\r\n                    if (_scope.isTable) {\r\n                        _$scope.for_all_descendants(\r\n                            $params.dragInfo.node, function (_node, _parent) {\r\n                                _scope   = _$scope.getScope(_node);\r\n                                _element = _scope && _scope.$element;\r\n                                if (_scope && _element && (!_parent && _node.__visible__ || _parent.__expanded__)) {\r\n                                    if (_$scope.$class.hidden) {\r\n                                        _element.removeClass(_$scope.$class.hidden);\r\n                                    }\r\n                                }\r\n                                return _node.__visible__ === false || _node.__expanded__ === false\r\n                            }, null, true\r\n                        );\r\n                    } else {\r\n                        if (_$scope.$class.hidden) {\r\n                            _element.removeClass(_$scope.$class.hidden);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            function _$init(scope, element, $window, $document) {\r\n                var $params        = {\r\n                        hasTouch:        'ontouchstart' in window,\r\n                        firstMoving:     null,\r\n                        dragInfo:        null,\r\n                        pos:             null,\r\n                        placeElm:        null,\r\n                        dragElm:         null,\r\n                        dragDelaying:    true,\r\n                        dragStarted:     false,\r\n                        dragTimer:       null,\r\n                        body:            document.body,\r\n                        html:            document.documentElement,\r\n                        document_height: null,\r\n                        document_width:  null,\r\n                        offsetEdge:      null,\r\n                        $scope:          scope,\r\n                        $window:         $window,\r\n                        $document:       $document,\r\n                        element:         element,\r\n                        bindDrag:        function () {\r\n                            _fnBindDrag($params);\r\n                        },\r\n                        dragEnd:         function (e) {\r\n                            _fnDragEnd(e, $params);\r\n                        },\r\n                        dragMoveEvent:   function (e) {\r\n                            _fnDragMove(e, $params);\r\n                        },\r\n                        dragEndEvent:    function (e) {\r\n                            scope.$$apply = true;\r\n                            _fnDragEnd(e, $params);\r\n                        },\r\n                        dragCancelEvent: function (e) {\r\n                            _fnDragEnd(e, $params);\r\n                        }\r\n                    },\r\n                    keydownHandler = function (e) {\r\n                        return _fnKeydownHandler(e, $params);\r\n                    },\r\n                    keyupHandler   = function (e) {\r\n                        return _fnKeyupHandler(e, $params);\r\n                    };\r\n\r\n                scope.dragEnd = function (e) {\r\n                    $params.dragEnd(e);\r\n                };\r\n\r\n                $params.bindDrag();\r\n\r\n                angular.element($window.document.body).bind('keydown', keydownHandler);\r\n                angular.element($window.document.body).bind('keyup', keyupHandler);\r\n                //unbind handler that retains scope\r\n                scope.$on(\r\n                    '$destroy', function () {\r\n                        angular.element($window.document.body).unbind('keydown', keydownHandler);\r\n                        angular.element($window.document.body).unbind('keyup', keyupHandler);\r\n                        if (scope.statusElm) {\r\n                            scope.statusElm.remove();\r\n                        }\r\n\r\n                        if (scope.placeElm) {\r\n                            scope.placeElm.remove();\r\n                        }\r\n                    }\r\n                );\r\n            }\r\n\r\n            return _$init;\r\n        }\r\n    ]\r\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDControl', function () {\n        var _target, \n            _parent, \n            _children,\n            i, \n            len;\n\n        function fnSetCollapse(node) {\n            node.__expanded__ = false;\n        }\n\n        function fnSetExpand(node) {\n            node.__expanded__ = true;\n        }\n\n        function fnSetDeselect(node) {\n            node.__selected__ = false;\n        }\n\n        function _$init(scope) {\n              var n, tree = {\n                anchor_node:                     null,\n                selected_nodes:                    [],\n                for_all_descendants:               scope.for_all_descendants,\n                select_anchor_node:                       function (node) {\n                  if (!node) {\n                    return null;\n                  }\n                  if (node) {\n                    tree.deselect_all();\n                    tree.select_node(node);\n                    tree.anchor_node = node;\n                    tree.expand_all_parents(node);\n                  }\n                  return node;\n                },\n                select_node: function(node) {\n                  if (!node || tree.is_selected(node)) {\n                    return null;\n                  }\n                  node.__selected__ = true;\n                  tree.selected_nodes.push(node);\n                  return node;\n                },\n                is_selected: function (node) {\n                  return node.__selected__ === true;\n                },\n                add_select_node:                       function (node) {\n                  if (!node) {\n                    return null;\n                  }\n                  // don't select node if already selected\n                  if (tree.is_selected(node)) {\n                    tree.deselect_node(node);\n                    return null;\n                  }\n                  // select node before continuing\n                  // and deselect any descendants\n                  tree.select_node(node);\n                  tree.deselect_descendants(node);\n\n                  // clean up the new selection\n                  tree.process_selection();\n                  return node;\n                },\n                range_select_node:                       function (node) {\n                  if (!node) {\n                    return null; \n                  } else if (!tree.anchor_node) {\n                    // just select the node if the anchor node isn't set\n                    return tree.select_anchor_node(node);\n                  }\n\n                  // reset selection\n                  angular.forEach(tree.selected_nodes, fnSetDeselect);\n                  tree.selected_nodes = [];\n\n                  // put the selected node back in the list\n                  tree.select_node(tree.anchor_node);\n\n                  // Add all nodes leading to the selected node\n                  while (node && node !== tree.anchor_node) {\n                    tree.select_node(node);\n                    if (node.__index_real__ < tree.anchor_node.__index_real__) {\n                      node = tree.get_next_node(node);\n                    } else {\n                      node = tree.get_prev_node(node);\n                    }\n                  }\n\n                  // clean up the new selection\n                  tree.process_selection();\n                  return tree.selected_nodes;\n                },\n                deselect_node:                     function (node, preserve_anchor) {\n                  _target = null;\n                  if (node === tree.anchor_node && !preserve_anchor) {\n                    _target = tree.anchor_node;\n                    tree.anchor_node = null;\n                  }\n                  var selected = tree.is_selected(node),\n                      selectedIndex = tree.selected_nodes.indexOf(node);\n                  if (selected) {\n                    fnSetDeselect(node);\n                    tree.selected_nodes.splice(selectedIndex, 1);\n                    _target = node\n                  }\n                  return _target;\n                },\n                deselect_descendants: function(node) {\n                  node = node || tree.anchor_node;\n                  if (node) {\n                    _children = tree.get_children(node);\n                    if (_children.length > 0) {\n                      _children.forEach(function(child) {\n                        tree.deselect_descendants(child);\n                        tree.deselect_node(child, true);\n                      });\n                    }\n                  }\n                },\n                deselect_all:                     function () {\n                  if (tree.anchor_node) {\n                    tree.anchor_node = null;\n                  }\n                  if (tree.selected_nodes) {\n                    tree.selected_nodes.forEach(fnSetDeselect);\n                    tree.selected_nodes = [];\n                  }\n                },\n                // clean up the currently selected nodes and make sure a parent \n                // node is not selected if it's child is already selected.\n                // if all children of a node are selected, then deselect them \n                // and select the node itself.\n                process_selection:                function(nodes) {\n                  nodes = nodes || tree.selected_nodes;\n                  nodes.sort(function(a, b) {\n                    return a.__index_real__ - b.__index_real__;\n                  });\n                  nodes.forEach(cleanSelected);\n                  \n                  function cleanSelected(node) {\n                    var children = tree.get_children(node),\n                        selected_child_ct = 0,\n                        selected_descendant_ct  = 0;\n                        \n                    // Do I even have kids?\n                    if (children.length) {\n                      \n                      // Guess so! let's see if any of them are selected\n                      for (var i = 0; i < children.length; i++) {\n                        // First of all, do I have any selected grandkids? \n                        // I've gotta make some calls!\n                        selected_descendant_ct += cleanSelected(children[i]);\n                        \n                        // Let's keep count of my selected kids\n                        if (tree.is_selected(children[i])) {\n                          ++selected_child_ct;\n                        }\n                      }\n                      \n                      // If all of my kids are selected, \n                      // I might as well select myself instead\n                      if (selected_child_ct === children.length) {\n                        tree.select_node(node);\n                        tree.deselect_descendants(node);\n                        \n                      // If only some of my kids or grandkids are selected, \n                      // I shouldn't be because I don't want to include them twice\n                      } else if (selected_child_ct || selected_descendant_ct) {\n                        tree.deselect_node(node, true);\n                      }\n                    }\n\n                    // Mom called! She asked how many selected children I have.\n                    // Good thing I kept count!\n                    return selected_descendant_ct + selected_child_ct;\n                  }\n                },\n                get_parent:                        function (node) {\n                  if (node && node.__parent_real__ !== null) {\n                    return scope.tree_nodes[node.__parent_real__];\n                  }\n                  return null;\n                },\n                for_all_ancestors:                 function (child, fn) {\n                  _parent = tree.get_parent(child);\n                  if (_parent) {\n                    if (fn(_parent)) {\n                      return false;\n                    }\n\n                    return tree.for_all_ancestors(_parent, fn);\n                  }\n                  return true;\n                },\n                expand_all_parents:                function (child) {\n                  return tree.for_all_ancestors(\n                      child, fnSetExpand\n                  );\n                },\n                reload_data:                       function () {\n                  return scope.reload_data();\n                },\n                ungroup_node: function(node) {\n                  // get node\n                  node = node || tree.anchor_node;\n\n                  // if its a valid group with children\n                  if (node && node.__children__.length > 0) {\n                    var _parent = tree.get_parent(node),// get parent\n                        _index = node.__index__,        // get index\n                        _children = node.__children__;  // get children\n\n                    // deselect all nodes\n                    tree.deselect_all();\n\n                    // remove the parent node\n                    tree.remove_node(node);\n\n                    // add children starting at node index\n                    tree.add_nodes(_parent, _children, _index, true);\n                    tree.reload_data();\n                  }\n                },\n                group_selected_nodes:              function () {\n                  if (tree.selected_nodes.length) {\n                    // create new parent\n                    var new_parent = {nodeId: 'Group', groupId: 'NewGroup', __children__: []},\n                    // get selected nodes\n                        _nodes = tree.selected_nodes,\n                        _index = _nodes[0].__index__,\n                        _parent = tree.get_parent(_nodes[0]);\n\n                    // add selected to new group\n                    new_parent.__children__ = _nodes;\n\n                    // remove selected from tree\n                    tree.remove_nodes(_nodes, true);\n\n                    // add the new group to tree at the selected index\n                    tree.add_node(_parent, new_parent, _index || 0, false);\n\n                    new_parent.__expanded__ = false;\n                    tree.select_anchor_node(new_parent);\n                    tree.reload_data();\n                    return new_parent;\n                  } else  {\n                    return null;\n                  }\n                },\n                add_node:                          function (parent, new_node, index, add_to_selection) {\n                  if (typeof index !== 'number') {\n                    if (parent) {\n                      parent.__children__.push(new_node);\n                      parent.__expanded__ = true;\n                    } else {\n                      scope.treeData.push(new_node);\n                    }\n                  } else {\n                    if (parent) {\n                      parent.__children__.splice(index, 0, new_node);\n                      parent.__expanded__ = true;\n                    } else {\n                      scope.treeData.splice(index, 0, new_node);\n                    }\n                  }\n                  if (add_to_selection) {\n                    tree.select_node(new_node);\n                  }\n                  return new_node;\n                },\n                add_nodes: function(parent, nodes, start_index, add_to_selection) {\n                  nodes.forEach(function(node, i) {\n                      tree.add_node(parent, node, start_index + i, add_to_selection);\n                  });\n                },\n                add_node_root:                     function (new_node) {\n                  tree.add_node(null, new_node);\n                  return new_node;\n                },\n                expand_all:                        function () {\n                  len = scope.treeData.length;\n                  for (i = 0; i < len; i++) {\n                    tree.for_all_descendants(\n                        scope.treeData[i], fnSetExpand\n                    );\n                  }\n                },\n                collapse_all:                      function () {\n                  len = scope.treeData.length;\n                  for (i = 0; i < len; i++) {\n                    tree.for_all_descendants(\n                        scope.treeData[i], fnSetCollapse\n                    );\n                  }\n                },\n                remove_node:                       function (node) {\n                  node = node || tree.anchor_node;\n                  if (node) {\n\n                    if (node.__parent_real__ !== null) {\n                      _parent = tree.get_parent(node).__children__;\n                    } else {\n                      _parent = scope.treeData;\n                    }\n                    \n                    if (tree.anchor_node === node) {\n                      tree.anchor_node = null;\n                    }\n\n                    _parent.splice(node.__index__, 1);\n                    \n                  }\n                },\n                remove_nodes:                       function (nodes, delayReload) {\n                  nodes = nodes || tree.selected_nodes;\n\n                  // remove by last item first to avoid index confusion\n                  nodes = nodes.slice().sort(function(a, b) {\n                    return b.__index_real__ - a.__index_real__;\n                  })\n                  if (nodes) {\n                    angular.forEach(nodes, tree.remove_node);\n                  }\n                  if (!delayReload) {\n                    tree.reload_data();\n                  }\n                  return nodes;\n                },\n                expand_node:                        function (node) {\n                  node = node || tree.anchor_node;\n                  if (node) {\n                    node.__expanded__ = true;\n                    return node;\n                  }\n                },\n                collapse_node:                      function (node) {\n                  node = node || tree.anchor_node;\n                  if (node) {\n                    node.__expanded__ = false;\n                    return node;\n                  }\n                },\n                get_anchor_node:                    function () {\n                  return tree.anchor_node;\n                },\n                get_selected_nodes:                 function () {\n                  return tree.selected_nodes;\n                },\n                get_first_node:                     function () {\n                  len = scope.treeData.length;\n                  if (len > 0) {\n                    return scope.treeData[0];\n                  }\n                  return null;\n                },\n                get_children:                       function (node) {\n                  return node.__children__;\n                },\n                get_siblings:                       function (node) {\n                  node = node || tree.anchor_node;\n                  if (node) {\n                    _parent = tree.get_parent(node);\n                    if (_parent) {\n                      _target = _parent.__children__;\n                    } else {\n                      _target = scope.treeData;\n                    }\n                    return _target;\n                  }\n                },\n                get_next_sibling:                  function (node) {\n                  node = node || tree.anchor_node;\n                  if (node) {\n                    _target = tree.get_siblings(node);\n                    n = _target.length;\n                    if (node.__index__ < n) {\n                      return _target[node.__index__ + 1];\n                    }\n                  }\n                },\n                get_prev_sibling:                  function (node) {\n                  node = node || tree.anchor_node;\n                  _target = tree.get_siblings(node);\n                  if (node.__index__ > 0) {\n                    return _target[node.__index__ - 1];\n                  }\n                },\n                get_first_child:                   function (node) {\n                  node = node || tree.anchor_node;\n                  if (node) {\n                    _target = node.__children__;\n                    if (_target && _target.length > 0) {\n                      return node.__children__[0];\n                    }\n                  }\n                  return null;\n                },\n                get_closest_ancestor_next_sibling: function (node) {\n                  node = node || tree.anchor_node;\n                  _target = tree.get_next_sibling(node);\n                  if (_target) {\n                    return _target;\n                  }\n\n                  _parent = tree.get_parent(node);\n                  if (_parent) {\n                    return tree.get_closest_ancestor_next_sibling(_parent);\n                  }\n\n                  return null;\n                },\n                get_next_node:                     function (node) {\n                  node = node || tree.anchor_node;\n\n                  if (node) {\n                    _target = tree.get_first_child(node);\n                    if (_target) {\n                      return _target;\n                    } else {\n                      return tree.get_closest_ancestor_next_sibling(node);\n                    }\n                  }\n                },\n                get_prev_node:                     function (node) {\n                  node = node || tree.anchor_node;\n\n                  if (node) {\n                    _target = tree.get_prev_sibling(node);\n                    if (_target) {\n                      return tree.get_last_descendant(_target);\n                    }\n\n                    _parent = tree.get_parent(node);\n                    return _parent;\n                  }\n                },\n                get_last_descendant:               scope.getLastDescendant,\n                select_parent_node:                function (node) {\n                  node = node || tree.anchor_node;\n\n                  if (node) {\n                    _parent = tree.get_parent(node);\n                    if (_parent) {\n                      return tree.select_node(_parent);\n                    }\n                  }\n                },\n                select_first_node:                 function () {\n                  return tree.select_node(tree.get_first_node());\n                },\n                select_next_sibling:               function (node) {\n                  node = node || tree.anchor_node;\n\n                  if (node) {\n                    _target = tree.get_next_sibling(node);\n                    if (_target) {\n                      return tree.select_node(_target);\n                    }\n                  }\n                },\n                select_prev_sibling:               function (node) {\n                  node = node || tree.anchor_node;\n\n                  if (node) {\n                    _target = tree.get_prev_sibling(node);\n                    if (_target) {\n                      return tree.select_node(_target);\n                    }\n                  }\n                },\n                select_next_node:                  function (node) {\n                  node = node || tree.anchor_node;\n\n                  if (node) {\n                    _target = tree.get_next_node(node);\n                    if (_target) {\n                      return tree.select_node(_target);\n                    }\n                  }\n                },\n                select_prev_node:                  function (node) {\n                  node = node || tree.anchor_node;\n\n                  if (node) {\n                    _target = tree.get_prev_node(node);\n                    if (_target) {\n                      return tree.select_node(_target);\n                    }\n                  }\n                }\n              }\n              angular.extend(scope.tree, tree);\n              return scope.tree;\n            }\n        return _$init;\n    }\n);\n\nangular.module('template/TreeDnD/TreeDnD.html', []).run(\n    [\n        '$templateCache', function ($templateCache) {\n        $templateCache.put(\n            'template/TreeDnD/TreeDnD.html',\n            ['<table ng-class=\"$tree_class\">',\n             '    <thead>',\n             '  <tr>',\n             '     <th ng-class=\"expandingProperty.titleClass\" ng-style=\"expandingProperty.titleStyle\">',\n             '         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}',\n             '        <\\/th>',\n             '        <th ng-repeat=\"col in colDefinitions\" ng-class=\"col.titleClass\" ng-style=\"col.titleStyle\">',\n             '         {{col.displayName || col.field}}',\n             '     </th>',\n             '    </tr>',\n             '    </thead>',\n             ' <tbody tree-dnd-nodes>',\n             '  <tr tree-dnd-node=\"node\" ng-repeat=\"node in tree_nodes track by node.__hashKey__\" ',\n             '       ng-if=\"(node.__inited__ || node.__visible__)\"',\n             '       ng-click=\"onSelect(node)\" ',\n             '       ng-class=\"(node.__selected__ ? \\' active\\':\\'\\')\">',\n             '        <td tree-dnd-node-handle',\n             '          ng-style=\"expandingProperty.cellStyle ? expandingProperty.cellStyle : {\\'padding-left\\': $callbacks.calsIndent(node.__level__)}\"',\n             '          ng-class=\"expandingProperty.cellClass\"',\n             '          compile=\"expandingProperty.cellTemplate\">',\n             '              <a data-nodrag>',\n             '                  <i ng-class=\"node.__icon_class__\" ng-click=\"toggleExpand(node)\"',\n             '                     class=\"tree-icon\"></i>',\n             '              </a>',\n             '             {{node[expandingProperty.field] || node[expandingProperty]}}',\n             '        </td>',\n             '        <td ng-repeat=\"col in colDefinitions\" ng-class=\"col.cellClass\" ng-style=\"col.cellStyle\"',\n             '            compile=\"col.cellTemplate\">',\n             '            {{node[col.field]}}',\n             '        </td>',\n             '    </tr>',\n             '    </tbody>',\n             '</table>'].join('\\n')\n        );\n\n        $templateCache.put(\n            'template/TreeDnD/TreeDnDStatusCopy.html',\n            '<label><i class=\"fa fa-copy\"></i>&nbsp;<b>Copying</b></label>'\n        );\n\n        $templateCache.put(\n            'template/TreeDnD/TreeDnDStatusMove.html',\n            '<label><i class=\"fa fa-file-text\"></i>&nbsp;<b>Moving</b></label>'\n        );\n    }]\n);\n\n    function isUndefinedOrNull(val) {\n        return angular.isUndefined(val) || val === null;\n    }\n\n    function isDefined(val) {\n        return !(angular.isUndefined(val) || val === null);\n    }\n})();"],"sourceRoot":"/source/"}